import{g as F,S as gs,a as ui,b as ut,R as hi,T as fi,c as gt,d as An,L as di,e as ve,F as wn,M as U,V as z,C as K,f as pi,P as mi,D as Rn,h as Ge,i as ie,I as gi,Q as Sn,j as vi,O as _n,k as vs,l as Ti,B as ke,m as xi,n as bn,N as yi,o as Ei,p as Ai,q as Q,r as Lt,s as He,t as wi,u as vt,v as Ri,w as Be,x as Si,y as Mn,z as at,A as de,E as _i,G as Cn,H as bi,J as Gt,K as Mi,U as Ci,W as Li,X as Ii,Y as ht,Z as Ht,_ as Pi,$ as Ut,a0 as Ni,a1 as Oi,a2 as Di,a3 as Fi,a4 as Ln,a5 as ki,a6 as Je,a7 as nn,a8 as sn,a9 as rn,aa as Ts,ab as Bi,ac as Gi,ad as Hi,ae as on,af as $,ag as Pr,ah as Nr,ai as Or,aj as Dr,ak as jt,al as In,am as It,an as Xt,ao as Tt,ap as Ui,aq as ce,ar as ji,as as xs,at as V,au as Fr,av as Vi,aw as zi,ax as ys,ay as Ki,az as Ls,aA as kr,aB as Yn,aC as Is,aD as Xi,aE as Br,aF as Gr,aG as Hr,aH as Ur,aI as jr,aJ as Vr,aK as zr,aL as Kr,aM as Xr,aN as Wr,aO as qr,aP as Ps,aQ as Ns,aR as $r,aS as Yr}from"./matrix-D_Gcipgq.js";function Qr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,typeof(s=(function(i,o){if(typeof i!="object"||i===null)return i;var c=i[Symbol.toPrimitive];if(c!==void 0){var a=c.call(i,"string");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)})(n.key))=="symbol"?s:String(s),n)}var s}function Es(r,e,t){return e&&Qr(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function pe(){return pe=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},pe.apply(this,arguments)}function Pn(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Pt(r,e)}function Qn(r){return Qn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qn(r)}function Pt(r,e){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Pt(r,e)}function Zr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Zn(r,e,t){return Zn=Zr()?Reflect.construct.bind():function(n,s,i){var o=[null];o.push.apply(o,s);var c=new(Function.bind.apply(n,o));return i&&Pt(c,i.prototype),c},Zn.apply(null,arguments)}function Jn(r){var e=typeof Map=="function"?new Map:void 0;return Jn=function(t){if(t===null||Function.toString.call(t).indexOf("[native code]")===-1)return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return Zn(t,arguments,Qn(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Pt(n,t)},Jn(r)}function Jr(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}var Oe,eo=function(){this.before=void 0,this.beforeLeave=void 0,this.leave=void 0,this.afterLeave=void 0,this.beforeEnter=void 0,this.enter=void 0,this.afterEnter=void 0,this.after=void 0};(function(r){r[r.off=0]="off",r[r.error=1]="error",r[r.warning=2]="warning",r[r.info=3]="info",r[r.debug=4]="debug"})(Oe||(Oe={}));var Os=Oe.off,We=(function(){function r(t){this.t=void 0,this.t=t}r.getLevel=function(){return Os},r.setLevel=function(t){return Os=Oe[t]};var e=r.prototype;return e.error=function(){this.i(console.error,Oe.error,[].slice.call(arguments))},e.warn=function(){this.i(console.warn,Oe.warning,[].slice.call(arguments))},e.info=function(){this.i(console.info,Oe.info,[].slice.call(arguments))},e.debug=function(){this.i(console.log,Oe.debug,[].slice.call(arguments))},e.i=function(t,n,s){n<=r.getLevel()&&t.apply(console,["["+this.t+"] "].concat(s))},r})();function nt(r){return r.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Ds(r){return r&&r.sensitive?"":"i"}var Te={container:"container",history:"history",namespace:"namespace",prefix:"data-barba",prevent:"prevent",wrapper:"wrapper"},qe=new((function(){function r(){this.o=Te,this.u=void 0,this.h={after:null,before:null,parent:null}}var e=r.prototype;return e.toString=function(t){return t.outerHTML},e.toDocument=function(t){return this.u||(this.u=new DOMParser),this.u.parseFromString(t,"text/html")},e.toElement=function(t){var n=document.createElement("div");return n.innerHTML=t,n},e.getHtml=function(t){return t===void 0&&(t=document),this.toString(t.documentElement)},e.getWrapper=function(t){return t===void 0&&(t=document),t.querySelector("["+this.o.prefix+'="'+this.o.wrapper+'"]')},e.getContainer=function(t){return t===void 0&&(t=document),t.querySelector("["+this.o.prefix+'="'+this.o.container+'"]')},e.removeContainer=function(t){document.body.contains(t)&&(this.v(t),t.parentNode.removeChild(t))},e.addContainer=function(t,n){var s=this.getContainer()||this.h.before;s?this.l(t,s):this.h.after?this.h.after.parentNode.insertBefore(t,this.h.after):this.h.parent?this.h.parent.appendChild(t):n.appendChild(t)},e.getSibling=function(){return this.h},e.getNamespace=function(t){t===void 0&&(t=document);var n=t.querySelector("["+this.o.prefix+"-"+this.o.namespace+"]");return n?n.getAttribute(this.o.prefix+"-"+this.o.namespace):null},e.getHref=function(t){if(t.tagName&&t.tagName.toLowerCase()==="a"){if(typeof t.href=="string")return t.href;var n=t.getAttribute("href")||t.getAttribute("xlink:href");if(n)return this.resolveUrl(n.baseVal||n)}return null},e.resolveUrl=function(){var t=[].slice.call(arguments).length;if(t===0)throw new Error("resolveUrl requires at least one argument; got none.");var n=document.createElement("base");if(n.href=arguments[0],t===1)return n.href;var s=document.getElementsByTagName("head")[0];s.insertBefore(n,s.firstChild);for(var i,o=document.createElement("a"),c=1;c<t;c++)o.href=arguments[c],n.href=i=o.href;return s.removeChild(n),i},e.l=function(t,n){n.parentNode.insertBefore(t,n.nextSibling)},e.v=function(t){return this.h={after:t.nextElementSibling,before:t.previousElementSibling,parent:t.parentElement},this.h},r})()),to=(function(){function r(){this.p=void 0,this.m=[],this.P=-1}var e=r.prototype;return e.init=function(t,n){this.p="barba";var s={data:{},ns:n,scroll:{x:window.scrollX,y:window.scrollY},url:t};this.P=0,this.m.push(s);var i={from:this.p,index:this.P,states:[].concat(this.m)};window.history&&window.history.replaceState(i,"",t)},e.change=function(t,n,s){if(s&&s.state){var i=s.state,o=i.index;n=this.g(this.P-o),this.replace(i.states),this.P=o}else this.add(t,n);return n},e.add=function(t,n,s,i){var o=s??this.R(n),c={data:i??{},ns:"tmp",scroll:{x:window.scrollX,y:window.scrollY},url:t};switch(o){case"push":this.P=this.size,this.m.push(c);break;case"replace":this.set(this.P,c)}var a={from:this.p,index:this.P,states:[].concat(this.m)};switch(o){case"push":window.history&&window.history.pushState(a,"",t);break;case"replace":window.history&&window.history.replaceState(a,"",t)}},e.store=function(t,n){var s=n||this.P,i=this.get(s);i.data=pe({},i.data,t),this.set(s,i);var o={from:this.p,index:this.P,states:[].concat(this.m)};window.history.replaceState(o,"")},e.update=function(t,n){var s=n||this.P,i=pe({},this.get(s),t);this.set(s,i)},e.remove=function(t){t?this.m.splice(t,1):this.m.pop(),this.P--},e.clear=function(){this.m=[],this.P=-1},e.replace=function(t){this.m=t},e.get=function(t){return this.m[t]},e.set=function(t,n){return this.m[t]=n},e.R=function(t){var n="push",s=t,i=Te.prefix+"-"+Te.history;return s.hasAttribute&&s.hasAttribute(i)&&(n=s.getAttribute(i)),n},e.g=function(t){return Math.abs(t)>1?t>0?"forward":"back":t===0?"popstate":t>0?"back":"forward"},Es(r,[{key:"current",get:function(){return this.m[this.P]}},{key:"previous",get:function(){return this.P<1?null:this.m[this.P-1]}},{key:"size",get:function(){return this.m.length}}]),r})(),Wi=new to,an=function(r,e){try{var t=(function(){if(!e.next.html)return Promise.resolve(r).then(function(n){var s=e.next;if(n){var i=qe.toElement(n.html);s.namespace=qe.getNamespace(i),s.container=qe.getContainer(i),s.url=n.url,s.html=n.html,Wi.update({ns:s.namespace});var o=qe.toDocument(n.html);document.title=o.title}})})();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(n){return Promise.reject(n)}},qi=function r(e,t,n){return e instanceof RegExp?(function(s,i){if(!i)return s;for(var o=/\((?:\?<(.*?)>)?(?!\?)/g,c=0,a=o.exec(s.source);a;)i.push({name:a[1]||c++,prefix:"",suffix:"",modifier:"",pattern:""}),a=o.exec(s.source);return s})(e,t):Array.isArray(e)?(function(s,i,o){var c=s.map(function(a){return r(a,i,o).source});return new RegExp("(?:".concat(c.join("|"),")"),Ds(o))})(e,t,n):(function(s,i,o){return(function(c,a,l){l===void 0&&(l={});for(var h=l.strict,u=h!==void 0&&h,f=l.start,d=f===void 0||f,p=l.end,m=p===void 0||p,g=l.encode,v=g===void 0?function(W){return W}:g,T=l.delimiter,x=T===void 0?"/#?":T,y=l.endsWith,A="[".concat(nt(y===void 0?"":y),"]|$"),w="[".concat(nt(x),"]"),E=d?"^":"",_=0,R=c;_<R.length;_++){var S=R[_];if(typeof S=="string")E+=nt(v(S));else{var P=nt(v(S.prefix)),b=nt(v(S.suffix));if(S.pattern)if(a&&a.push(S),P||b)if(S.modifier==="+"||S.modifier==="*"){var D=S.modifier==="*"?"?":"";E+="(?:".concat(P,"((?:").concat(S.pattern,")(?:").concat(b).concat(P,"(?:").concat(S.pattern,"))*)").concat(b,")").concat(D)}else E+="(?:".concat(P,"(").concat(S.pattern,")").concat(b,")").concat(S.modifier);else E+=S.modifier==="+"||S.modifier==="*"?"((?:".concat(S.pattern,")").concat(S.modifier,")"):"(".concat(S.pattern,")").concat(S.modifier);else E+="(?:".concat(P).concat(b,")").concat(S.modifier)}}if(m)u||(E+="".concat(w,"?")),E+=l.endsWith?"(?=".concat(A,")"):"$";else{var L=c[c.length-1],B=typeof L=="string"?w.indexOf(L[L.length-1])>-1:L===void 0;u||(E+="(?:".concat(w,"(?=").concat(A,"))?")),B||(E+="(?=".concat(w,"|").concat(A,")"))}return new RegExp(E,Ds(l))})((function(c,a){a===void 0&&(a={});for(var l=(function(b){for(var D=[],L=0;L<b.length;){var B=b[L];if(B!=="*"&&B!=="+"&&B!=="?")if(B!=="\\")if(B!=="{")if(B!=="}")if(B!==":")if(B!=="(")D.push({type:"CHAR",index:L,value:b[L++]});else{var W=1,Ee="";if(b[H=L+1]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(H));for(;H<b.length;)if(b[H]!=="\\"){if(b[H]===")"){if(--W==0){H++;break}}else if(b[H]==="("&&(W++,b[H+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(H));Ee+=b[H++]}else Ee+=b[H++]+b[H++];if(W)throw new TypeError("Unbalanced pattern at ".concat(L));if(!Ee)throw new TypeError("Missing pattern at ".concat(L));D.push({type:"PATTERN",index:L,value:Ee}),L=H}else{for(var Ce="",H=L+1;H<b.length;){var ue=b.charCodeAt(H);if(!(ue>=48&&ue<=57||ue>=65&&ue<=90||ue>=97&&ue<=122||ue===95))break;Ce+=b[H++]}if(!Ce)throw new TypeError("Missing parameter name at ".concat(L));D.push({type:"NAME",index:L,value:Ce}),L=H}else D.push({type:"CLOSE",index:L,value:b[L++]});else D.push({type:"OPEN",index:L,value:b[L++]});else D.push({type:"ESCAPED_CHAR",index:L++,value:b[L++]});else D.push({type:"MODIFIER",index:L,value:b[L++]})}return D.push({type:"END",index:L,value:""}),D})(c),h=a.prefixes,u=h===void 0?"./":h,f="[^".concat(nt(a.delimiter||"/#?"),"]+?"),d=[],p=0,m=0,g="",v=function(b){if(m<l.length&&l[m].type===b)return l[m++].value},T=function(b){var D=v(b);if(D!==void 0)return D;var L=l[m],B=L.index;throw new TypeError("Unexpected ".concat(L.type," at ").concat(B,", expected ").concat(b))},x=function(){for(var b,D="";b=v("CHAR")||v("ESCAPED_CHAR");)D+=b;return D};m<l.length;){var y=v("CHAR"),A=v("NAME"),w=v("PATTERN");if(A||w)u.indexOf(_=y||"")===-1&&(g+=_,_=""),g&&(d.push(g),g=""),d.push({name:A||p++,prefix:_,suffix:"",pattern:w||f,modifier:v("MODIFIER")||""});else{var E=y||v("ESCAPED_CHAR");if(E)g+=E;else if(g&&(d.push(g),g=""),v("OPEN")){var _=x(),R=v("NAME")||"",S=v("PATTERN")||"",P=x();T("CLOSE"),d.push({name:R||(S?p++:""),pattern:R&&!S?f:S,prefix:_,suffix:P,modifier:v("MODIFIER")||""})}else T("END")}}return d})(s,o),i,o)})(e,t,n)},no={__proto__:null,update:an,nextTick:function(){return new Promise(function(r){window.requestAnimationFrame(r)})},pathToRegexp:qi},$i=function(){return window.location.origin},Nt=function(r){return r===void 0&&(r=window.location.href),De(r).port},De=function(r){var e,t=r.match(/:\d+/);if(t===null)/^http/.test(r)&&(e=80),/^https/.test(r)&&(e=443);else{var n=t[0].substring(1);e=parseInt(n,10)}var s,i=r.replace($i(),""),o={},c=i.indexOf("#");c>=0&&(s=i.slice(c+1),i=i.slice(0,c));var a=i.indexOf("?");return a>=0&&(o=Yi(i.slice(a+1)),i=i.slice(0,a)),{hash:s,path:i,port:e,query:o}},Yi=function(r){return r.split("&").reduce(function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{})},es=function(r){return r===void 0&&(r=window.location.href),r.replace(/(\/#.*|\/|#.*)$/,"")},so={__proto__:null,getHref:function(){return window.location.href},getAbsoluteHref:function(r,e){return e===void 0&&(e=document.baseURI),new URL(r,e).href},getOrigin:$i,getPort:Nt,getPath:function(r){return r===void 0&&(r=window.location.href),De(r).path},getQuery:function(r,e){return e===void 0&&(e=!1),e?JSON.stringify(De(r).query):De(r).query},getHash:function(r){return De(r).hash},parse:De,parseQuery:Yi,clean:es};function io(r,e,t,n,s){return e===void 0&&(e=2e3),new Promise(function(i,o){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){if(c.status===200){var a=c.responseURL!==""&&c.responseURL!==r?c.responseURL:r;i({html:c.responseText,url:pe({href:a},De(a))}),n.update(r,{status:"fulfilled",target:a})}else if(c.status){var l={status:c.status,statusText:c.statusText};t(r,l),o(l),n.update(r,{status:"rejected"})}}},c.ontimeout=function(){var a=new Error("Timeout error ["+e+"]");t(r,a),o(a),n.update(r,{status:"rejected"})},c.onerror=function(){var a=new Error("Fetch error");t(r,a),o(a),n.update(r,{status:"rejected"})},c.open("GET",r),c.timeout=e,c.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml"),c.setRequestHeader("x-barba","yes"),s.all().forEach(function(a,l){c.setRequestHeader(l,a)}),c.send()})}function ro(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function ct(r,e){return e===void 0&&(e={}),function(){var t=arguments,n=!1,s=new Promise(function(i,o){e.async=function(){return n=!0,function(a,l){a?o(a):i(l)}};var c=r.apply(e,[].slice.call(t));n||(ro(c)?c.then(i,o):i(c))});return s}}var Pe=new((function(r){function e(){var n;return(n=r.call(this)||this).logger=new We("@barba/core"),n.all=["ready","page","reset","currentAdded","currentRemoved","nextAdded","nextRemoved","beforeOnce","once","afterOnce","before","beforeLeave","leave","afterLeave","beforeEnter","enter","afterEnter","after"],n.registered=new Map,n.init(),n}Pn(e,r);var t=e.prototype;return t.init=function(){var n=this;this.registered.clear(),this.all.forEach(function(s){n[s]||(n[s]=function(i,o){n.registered.has(s)||n.registered.set(s,new Set),n.registered.get(s).add({ctx:o||{},fn:i})})})},t.do=function(n){var s=arguments,i=this;if(this.registered.has(n)){var o=Promise.resolve();return this.registered.get(n).forEach(function(c){o=o.then(function(){return ct(c.fn,c.ctx).apply(void 0,[].slice.call(s,1))})}),o.catch(function(c){i.logger.debug("Hook error ["+n+"]"),i.logger.error(c)})}return Promise.resolve()},t.clear=function(){var n=this;this.all.forEach(function(s){delete n[s]}),this.init()},t.help=function(){this.logger.info("Available hooks: "+this.all.join(","));var n=[];this.registered.forEach(function(s,i){return n.push(i)}),this.logger.info("Registered hooks: "+n.join(","))},e})(eo)),Qi=(function(){function r(e){if(this.k=void 0,this.O=[],typeof e=="boolean")this.k=e;else{var t=Array.isArray(e)?e:[e];this.O=t.map(function(n){return qi(n)})}}return r.prototype.checkHref=function(e){if(typeof this.k=="boolean")return this.k;var t=De(e).path;return this.O.some(function(n){return n.exec(t)!==null})},r})(),oo=(function(r){function e(n){var s;return(s=r.call(this,n)||this).T=new Map,s}Pn(e,r);var t=e.prototype;return t.set=function(n,s,i,o,c){return this.T.set(n,{action:i,request:s,status:o,target:c??n}),{action:i,request:s,status:o,target:c}},t.get=function(n){return this.T.get(n)},t.getRequest=function(n){return this.T.get(n).request},t.getAction=function(n){return this.T.get(n).action},t.getStatus=function(n){return this.T.get(n).status},t.getTarget=function(n){return this.T.get(n).target},t.has=function(n){return!this.checkHref(n)&&this.T.has(n)},t.delete=function(n){return this.T.delete(n)},t.update=function(n,s){var i=pe({},this.T.get(n),s);return this.T.set(n,i),i},e})(Qi),ao=(function(){function r(){this.A=new Map}var e=r.prototype;return e.set=function(t,n){return this.A.set(t,n),{name:n}},e.get=function(t){return this.A.get(t)},e.all=function(){return this.A},e.has=function(t){return this.A.has(t)},e.delete=function(t){return this.A.delete(t)},e.clear=function(){return this.A.clear()},r})(),co=function(){return!window.history.pushState},lo=function(r){return!r.el||!r.href},uo=function(r){var e=r.event;return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey},ho=function(r){var e=r.el;return e.hasAttribute("target")&&e.target==="_blank"},fo=function(r){var e=r.el;return e.protocol!==void 0&&window.location.protocol!==e.protocol||e.hostname!==void 0&&window.location.hostname!==e.hostname},po=function(r){var e=r.el;return e.port!==void 0&&Nt()!==Nt(e.href)},mo=function(r){var e=r.el;return e.getAttribute&&typeof e.getAttribute("download")=="string"},go=function(r){return r.el.hasAttribute(Te.prefix+"-"+Te.prevent)},vo=function(r){return!!r.el.closest("["+Te.prefix+"-"+Te.prevent+'="all"]')},To=function(r){var e=r.href;return es(e)===es()&&Nt(e)===Nt()},xo=(function(r){function e(n){var s;return(s=r.call(this,n)||this).suite=[],s.tests=new Map,s.init(),s}Pn(e,r);var t=e.prototype;return t.init=function(){this.add("pushState",co),this.add("exists",lo),this.add("newTab",uo),this.add("blank",ho),this.add("corsDomain",fo),this.add("corsPort",po),this.add("download",mo),this.add("preventSelf",go),this.add("preventAll",vo),this.add("sameUrl",To,!1)},t.add=function(n,s,i){i===void 0&&(i=!0),this.tests.set(n,s),i&&this.suite.push(n)},t.run=function(n,s,i,o){return this.tests.get(n)({el:s,event:i,href:o})},t.checkLink=function(n,s,i){var o=this;return this.suite.some(function(c){return o.run(c,n,s,i)})},e})(Qi),Dn=(function(r){function e(t,n){var s;return n===void 0&&(n="Barba error"),(s=r.call.apply(r,[this].concat([].slice.call(arguments,2)))||this).error=void 0,s.label=void 0,s.error=t,s.label=n,Error.captureStackTrace&&Error.captureStackTrace(Jr(s),e),s.name="BarbaError",s}return Pn(e,r),e})(Jn(Error)),yo=(function(){function r(t){t===void 0&&(t=[]),this.logger=new We("@barba/core"),this.all=[],this.page=[],this.once=[],this.j=[{name:"namespace",type:"strings"},{name:"custom",type:"function"}],t&&(this.all=this.all.concat(t)),this.update()}var e=r.prototype;return e.add=function(t,n){t==="rule"?this.j.splice(n.position||0,0,n.value):this.all.push(n),this.update()},e.resolve=function(t,n){var s=this;n===void 0&&(n={});var i=n.once?this.once:this.page;i=i.filter(n.self?function(f){return f.name&&f.name==="self"}:function(f){return!f.name||f.name!=="self"});var o=new Map,c=i.find(function(f){var d=!0,p={};return n.self&&f.name==="self"?(o.set(f,p),!0):(s.j.reverse().forEach(function(m){d&&(d=s.M(f,m,t,p),f.from&&f.to&&(d=s.M(f,m,t,p,"from")&&s.M(f,m,t,p,"to")),f.from&&!f.to&&(d=s.M(f,m,t,p,"from")),!f.from&&f.to&&(d=s.M(f,m,t,p,"to")))}),o.set(f,p),d)}),a=o.get(c),l=[];if(l.push(n.once?"once":"page"),n.self&&l.push("self"),a){var h,u=[c];Object.keys(a).length>0&&u.push(a),(h=this.logger).info.apply(h,["Transition found ["+l.join(",")+"]"].concat(u))}else this.logger.info("No transition found ["+l.join(",")+"]");return c},e.update=function(){var t=this;this.all=this.all.map(function(n){return t.N(n)}).sort(function(n,s){return n.priority-s.priority}).reverse().map(function(n){return delete n.priority,n}),this.page=this.all.filter(function(n){return n.leave!==void 0||n.enter!==void 0}),this.once=this.all.filter(function(n){return n.once!==void 0})},e.M=function(t,n,s,i,o){var c=!0,a=!1,l=t,h=n.name,u=h,f=h,d=h,p=o?l[o]:l,m=o==="to"?s.next:s.current;if(o?p&&p[h]:p[h]){switch(n.type){case"strings":default:var g=Array.isArray(p[u])?p[u]:[p[u]];m[u]&&g.indexOf(m[u])!==-1&&(a=!0),g.indexOf(m[u])===-1&&(c=!1);break;case"object":var v=Array.isArray(p[f])?p[f]:[p[f]];m[f]?(m[f].name&&v.indexOf(m[f].name)!==-1&&(a=!0),v.indexOf(m[f].name)===-1&&(c=!1)):c=!1;break;case"function":p[d](s)?a=!0:c=!1}a&&(o?(i[o]=i[o]||{},i[o][h]=l[o][h]):i[h]=l[h])}return c},e.S=function(t,n,s){var i=0;return(t[n]||t.from&&t.from[n]||t.to&&t.to[n])&&(i+=Math.pow(10,s),t.from&&t.from[n]&&(i+=1),t.to&&t.to[n]&&(i+=2)),i},e.N=function(t){var n=this;t.priority=0;var s=0;return this.j.forEach(function(i,o){s+=n.S(t,i.name,o+1)}),t.priority=s,t},r})();function yt(r,e){try{var t=r()}catch(n){return e(n)}return t&&t.then?t.then(void 0,e):t}var Eo=(function(){function r(t){t===void 0&&(t=[]),this.logger=new We("@barba/core"),this.store=void 0,this.C=!1,this.store=new yo(t)}var e=r.prototype;return e.get=function(t,n){return this.store.resolve(t,n)},e.doOnce=function(t){var n=t.data,s=t.transition;try{var i=function(){o.C=!1},o=this,c=s||{};o.C=!0;var a=yt(function(){return Promise.resolve(o.L("beforeOnce",n,c)).then(function(){return Promise.resolve(o.once(n,c)).then(function(){return Promise.resolve(o.L("afterOnce",n,c)).then(function(){})})})},function(l){o.C=!1,o.logger.debug("Transition error [before/after/once]"),o.logger.error(l)});return Promise.resolve(a&&a.then?a.then(i):i())}catch(l){return Promise.reject(l)}},e.doPage=function(t){var n=t.data,s=t.transition,i=t.page,o=t.wrapper;try{var c=function(f){a.C=!1},a=this,l=s||{},h=l.sync===!0||!1;a.C=!0;var u=yt(function(){function f(){return Promise.resolve(a.L("before",n,l)).then(function(){function p(g){return Promise.resolve(a.remove(n)).then(function(){return Promise.resolve(a.L("after",n,l)).then(function(){})})}var m=(function(){if(h)return yt(function(){return Promise.resolve(a.add(n,o)).then(function(){return Promise.resolve(a.L("beforeLeave",n,l)).then(function(){return Promise.resolve(a.L("beforeEnter",n,l)).then(function(){return Promise.resolve(Promise.all([a.leave(n,l),a.enter(n,l)])).then(function(){return Promise.resolve(a.L("afterLeave",n,l)).then(function(){return Promise.resolve(a.L("afterEnter",n,l)).then(function(){})})})})})})},function(x){if(a.H(x))throw new Dn(x,"Transition error [sync]")});var g=function(x){return yt(function(){var y=(function(){if(v!==!1)return Promise.resolve(a.add(n,o)).then(function(){return Promise.resolve(a.L("beforeEnter",n,l)).then(function(){return Promise.resolve(a.enter(n,l,v)).then(function(){return Promise.resolve(a.L("afterEnter",n,l)).then(function(){})})})})})();if(y&&y.then)return y.then(function(){})},function(y){if(a.H(y))throw new Dn(y,"Transition error [before/after/enter]")})},v=!1,T=yt(function(){return Promise.resolve(a.L("beforeLeave",n,l)).then(function(){return Promise.resolve(Promise.all([a.leave(n,l),an(i,n)]).then(function(x){return x[0]})).then(function(x){return v=x,Promise.resolve(a.L("afterLeave",n,l)).then(function(){})})})},function(x){if(a.H(x))throw new Dn(x,"Transition error [before/after/leave]")});return T&&T.then?T.then(g):g()})();return m&&m.then?m.then(p):p()})}var d=(function(){if(h)return Promise.resolve(an(i,n)).then(function(){})})();return d&&d.then?d.then(f):f()},function(f){throw a.C=!1,f.name&&f.name==="BarbaError"?(a.logger.debug(f.label),a.logger.error(f.error),f):(a.logger.debug("Transition error [page]"),a.logger.error(f),f)});return Promise.resolve(u&&u.then?u.then(c):c())}catch(f){return Promise.reject(f)}},e.once=function(t,n){try{return Promise.resolve(Pe.do("once",t,n)).then(function(){return n.once?ct(n.once,n)(t):Promise.resolve()})}catch(s){return Promise.reject(s)}},e.leave=function(t,n){try{return Promise.resolve(Pe.do("leave",t,n)).then(function(){return n.leave?ct(n.leave,n)(t):Promise.resolve()})}catch(s){return Promise.reject(s)}},e.enter=function(t,n,s){try{return Promise.resolve(Pe.do("enter",t,n)).then(function(){return n.enter?ct(n.enter,n)(t,s):Promise.resolve()})}catch(i){return Promise.reject(i)}},e.add=function(t,n){try{return qe.addContainer(t.next.container,n),Pe.do("nextAdded",t),Promise.resolve()}catch(s){return Promise.reject(s)}},e.remove=function(t){try{return qe.removeContainer(t.current.container),Pe.do("currentRemoved",t),Promise.resolve()}catch(n){return Promise.reject(n)}},e.H=function(t){return t.message?!/Timeout error|Fetch error/.test(t.message):!t.status},e.L=function(t,n,s){try{return Promise.resolve(Pe.do(t,n,s)).then(function(){return s[t]?ct(s[t],s)(n):Promise.resolve()})}catch(i){return Promise.reject(i)}},Es(r,[{key:"isRunning",get:function(){return this.C},set:function(t){this.C=t}},{key:"hasOnce",get:function(){return this.store.once.length>0}},{key:"hasSelf",get:function(){return this.store.all.some(function(t){return t.name==="self"})}},{key:"shouldWait",get:function(){return this.store.all.some(function(t){return t.to&&!t.to.route||t.sync})}}]),r})(),Ao=(function(){function r(e){var t=this;this.names=["beforeLeave","afterLeave","beforeEnter","afterEnter"],this.byNamespace=new Map,e.length!==0&&(e.forEach(function(n){t.byNamespace.set(n.namespace,n)}),this.names.forEach(function(n){Pe[n](t._(n))}))}return r.prototype._=function(e){var t=this;return function(n){var s=e.match(/enter/i)?n.next:n.current,i=t.byNamespace.get(s.namespace);return i&&i[e]?ct(i[e],i)(n):Promise.resolve()}},r})();Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(r){var e=this;do{if(e.matches(r))return e;e=e.parentElement||e.parentNode}while(e!==null&&e.nodeType===1);return null});var wo={container:null,html:"",namespace:"",url:{hash:"",href:"",path:"",port:null,query:{}}},As=new((function(){function r(){this.version="2.10.3",this.schemaPage=wo,this.Logger=We,this.logger=new We("@barba/core"),this.plugins=[],this.timeout=void 0,this.cacheIgnore=void 0,this.cacheFirstPage=void 0,this.prefetchIgnore=void 0,this.preventRunning=void 0,this.hooks=Pe,this.cache=void 0,this.headers=void 0,this.prevent=void 0,this.transitions=void 0,this.views=void 0,this.dom=qe,this.helpers=no,this.history=Wi,this.request=io,this.url=so,this.D=void 0,this.B=void 0,this.q=void 0,this.F=void 0}var e=r.prototype;return e.use=function(t,n){var s=this.plugins;s.indexOf(t)>-1?this.logger.warn("Plugin ["+t.name+"] already installed."):typeof t.install=="function"?(t.install(this,n),s.push(t)):this.logger.warn("Plugin ["+t.name+'] has no "install" method.')},e.init=function(t){var n=t===void 0?{}:t,s=n.transitions,i=s===void 0?[]:s,o=n.views,c=o===void 0?[]:o,a=n.schema,l=a===void 0?Te:a,h=n.requestError,u=n.timeout,f=u===void 0?2e3:u,d=n.cacheIgnore,p=d!==void 0&&d,m=n.cacheFirstPage,g=m!==void 0&&m,v=n.prefetchIgnore,T=v!==void 0&&v,x=n.preventRunning,y=x!==void 0&&x,A=n.prevent,w=A===void 0?null:A,E=n.debug,_=n.logLevel;if(We.setLevel((E!==void 0&&E)===!0?"debug":_===void 0?"off":_),this.logger.info(this.version),Object.keys(l).forEach(function(P){Te[P]&&(Te[P]=l[P])}),this.B=h,this.timeout=f,this.cacheIgnore=p,this.cacheFirstPage=g,this.prefetchIgnore=T,this.preventRunning=y,this.q=this.dom.getWrapper(),!this.q)throw new Error("[@barba/core] No Barba wrapper found");this.I();var R=this.data.current;if(!R.container)throw new Error("[@barba/core] No Barba container found");if(this.cache=new oo(p),this.headers=new ao,this.prevent=new xo(T),this.transitions=new Eo(i),this.views=new Ao(c),w!==null){if(typeof w!="function")throw new Error("[@barba/core] Prevent should be a function");this.prevent.add("preventCustom",w)}this.history.init(R.url.href,R.namespace),g&&this.cache.set(R.url.href,Promise.resolve({html:R.html,url:R.url}),"init","fulfilled"),this.U=this.U.bind(this),this.$=this.$.bind(this),this.X=this.X.bind(this),this.G(),this.plugins.forEach(function(P){return P.init()});var S=this.data;S.trigger="barba",S.next=S.current,S.current=pe({},this.schemaPage),this.hooks.do("ready",S),this.once(S),this.I()},e.destroy=function(){this.I(),this.J(),this.history.clear(),this.hooks.clear(),this.plugins=[]},e.force=function(t){window.location.assign(t)},e.go=function(t,n,s){var i;if(n===void 0&&(n="barba"),this.F=null,this.transitions.isRunning)this.force(t);else if(!(i=n==="popstate"?this.history.current&&this.url.getPath(this.history.current.url)===this.url.getPath(t)&&this.url.getQuery(this.history.current.url,!0)===this.url.getQuery(t,!0):this.prevent.run("sameUrl",null,null,t))||this.transitions.hasSelf)return n=this.history.change(this.cache.has(t)?this.cache.get(t).target:t,n,s),s&&(s.stopPropagation(),s.preventDefault()),this.page(t,n,s??void 0,i)},e.once=function(t){try{var n=this;return Promise.resolve(n.hooks.do("beforeEnter",t)).then(function(){function s(){return Promise.resolve(n.hooks.do("afterEnter",t)).then(function(){})}var i=(function(){if(n.transitions.hasOnce){var o=n.transitions.get(t,{once:!0});return Promise.resolve(n.transitions.doOnce({transition:o,data:t})).then(function(){})}})();return i&&i.then?i.then(s):s()})}catch(s){return Promise.reject(s)}},e.page=function(t,n,s,i){try{var o,c=function(){var u=a.data;return Promise.resolve(a.hooks.do("page",u)).then(function(){var f=(function(d,p){try{var m=(g=a.transitions.get(u,{once:!1,self:i}),Promise.resolve(a.transitions.doPage({data:u,page:o,transition:g,wrapper:a.q})).then(function(){a.I()}))}catch{return p()}var g;return m&&m.then?m.then(void 0,p):m})(0,function(){We.getLevel()===0&&a.force(u.next.url.href)});if(f&&f.then)return f.then(function(){})})},a=this;if(a.data.next.url=pe({href:t},a.url.parse(t)),a.data.trigger=n,a.data.event=s,a.cache.has(t))o=a.cache.update(t,{action:"click"}).request;else{var l=a.request(t,a.timeout,a.onRequestError.bind(a,n),a.cache,a.headers);l.then(function(u){u.url.href!==t&&a.history.add(u.url.href,n,"replace")}),o=a.cache.set(t,l,"click","pending").request}var h=(function(){if(a.transitions.shouldWait)return Promise.resolve(an(o,a.data)).then(function(){})})();return Promise.resolve(h&&h.then?h.then(c):c())}catch(u){return Promise.reject(u)}},e.onRequestError=function(t){this.transitions.isRunning=!1;var n=[].slice.call(arguments,1),s=n[0],i=n[1],o=this.cache.getAction(s);return this.cache.delete(s),this.B&&this.B(t,o,s,i)===!1||o==="click"&&this.force(s),!1},e.prefetch=function(t){var n=this;t=this.url.getAbsoluteHref(t),this.cache.has(t)||this.cache.set(t,this.request(t,this.timeout,this.onRequestError.bind(this,"barba"),this.cache,this.headers).catch(function(s){n.logger.error(s)}),"prefetch","pending")},e.G=function(){this.prefetchIgnore!==!0&&(document.addEventListener("mouseover",this.U),document.addEventListener("touchstart",this.U)),document.addEventListener("click",this.$),window.addEventListener("popstate",this.X)},e.J=function(){this.prefetchIgnore!==!0&&(document.removeEventListener("mouseover",this.U),document.removeEventListener("touchstart",this.U)),document.removeEventListener("click",this.$),window.removeEventListener("popstate",this.X)},e.U=function(t){var n=this,s=this.W(t);if(s){var i=this.url.getAbsoluteHref(this.dom.getHref(s));this.prevent.checkHref(i)||this.cache.has(i)||this.cache.set(i,this.request(i,this.timeout,this.onRequestError.bind(this,s),this.cache,this.headers).catch(function(o){n.logger.error(o)}),"enter","pending")}},e.$=function(t){var n=this.W(t);if(n){if(this.transitions.isRunning&&this.preventRunning)return t.preventDefault(),void t.stopPropagation();this.F=t,this.go(this.dom.getHref(n),n,t)}},e.X=function(t){this.go(this.url.getHref(),"popstate",t)},e.W=function(t){for(var n=t.target;n&&!this.dom.getHref(n);)n=n.parentNode;if(n&&!this.prevent.checkLink(n,t,this.dom.getHref(n)))return n},e.I=function(){var t=this.url.getHref(),n={container:this.dom.getContainer(),html:this.dom.getHtml(),namespace:this.dom.getNamespace(),url:pe({href:t},this.url.parse(t))};this.D={current:n,event:void 0,next:pe({},this.schemaPage),trigger:void 0},this.hooks.do("reset",this.data)},Es(r,[{key:"data",get:function(){return this.D}},{key:"wrapper",get:function(){return this.q}}]),r})());F.registerPlugin(gs);class Zi{constructor(e){this.galleryContainer=e,this.galleryItems=[],this.currentExpandedIndex=0,this.isMobile=!1,this.clickedItems=new Set,this.collapsedWidth=20,this.expandedWidth=400,this.mobileExpandedWidth=100,this.gap=5,this.init()}checkScreenSize(){const e=window.innerWidth<1e3,t=!this.isMobile;this.isMobile=e,(t&&this.isMobile||!t&&!this.isMobile)&&(this.createGallery(),this.setupEventListeners())}createGallery(){this.galleryContainer.innerHTML="",this.clickedItems.clear();const e=this.isMobile?10:20;for(let t=1;t<=e;t++){const n=document.createElement("div");n.className="spotlight-gallery-item";const s=document.createElement("img");s.src=`/spotlight/spotlight-${t}.jpg`,s.alt=`Spotlight ${t}`,n.appendChild(s),this.galleryContainer.appendChild(n)}this.galleryItems=this.galleryContainer.querySelectorAll(".spotlight-gallery-item"),this.currentExpandedIndex=0,this.updateGalleryLayout(this.currentExpandedIndex)}calculatePositions(e){const t=[],n=this.galleryItems.length,s=this.isMobile?this.mobileExpandedWidth:this.expandedWidth;let i=0;for(let l=0;l<n;l++)l===e?i+=s+this.gap:i+=this.collapsedWidth+this.gap;i-=this.gap;let a=(this.galleryContainer.offsetWidth-i)/2;for(let l=0;l<n;l++)l===e?(t.push({left:a,width:s}),a+=s+this.gap):(t.push({left:a,width:this.collapsedWidth}),a+=this.collapsedWidth+this.gap);return t}updateGalleryLayout(e){const t=this.calculatePositions(e);this.galleryItems.forEach((n,s)=>{const i=t[s];n.style.left=`${i.left}px`,n.style.width=`${i.width}px`})}handleDesktopEvents(){this.galleryItems.forEach((e,t)=>{e.addEventListener("mouseenter",()=>{this.currentExpandedIndex=t,this.updateGalleryLayout(this.currentExpandedIndex)})})}handleMobileEvents(){this.galleryItems.forEach((e,t)=>{e.addEventListener("click",()=>{if(this.clickedItems.has(t)&&this.currentExpandedIndex===t){this.clickedItems.delete(t);const n=this.clickedItems.size>0?Math.min(...this.clickedItems):0;this.currentExpandedIndex=n}else this.clickedItems.add(t),this.currentExpandedIndex=t;this.updateGalleryLayout(this.currentExpandedIndex)})})}removeEventListeners(){this.galleryItems.forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}),this.galleryItems=this.galleryContainer.querySelectorAll(".spotlight-gallery-item")}setupEventListeners(){this.removeEventListeners(),this.isMobile?this.handleMobileEvents():this.handleDesktopEvents()}handleResize(){this.checkScreenSize(),setTimeout(()=>{this.updateGalleryLayout(this.currentExpandedIndex)},100)}init(){this.galleryContainer&&(this.checkScreenSize(),this.createGallery(),this.setupEventListeners(),window.addEventListener("resize",()=>this.handleResize()))}refresh(){this.createGallery(),this.setupEventListeners()}destroy(){this.removeEventListeners(),window.removeEventListener("resize",this.handleResize),this.galleryContainer.innerHTML=""}}function Ji(){document.querySelectorAll(".spotlight-gallery").forEach(e=>{new Zi(e)})}document.addEventListener("DOMContentLoaded",()=>{Ji()});window.SpotlightGallery=Zi;const Fn=new Map;F.registerPlugin(ui,gs);function Et(r){return r?new Promise(e=>r.eventCallback("onComplete",e)):Promise.resolve()}function er(r){if(!r)return null;if(Fn.has(r))return Fn.get(r);const e=new ui(r,{type:"lines, words, chars",linesClass:"line++",lineThreshold:.1});return e.lines&&e.lines.forEach(t=>{t.style.overflow="hidden"}),Fn.set(r,e),e}function cn(r,{direction:e="up",duration:t=1,stagger:n=.1,ease:s="power4.out",delay:i=0,animateOnScroll:o=!0}={}){const c=er(r);if(!c||!c.lines.length)return null;const a=e==="down"?"100%":"-100%",l="0%";F.set(c.lines,{y:a});const h={y:l,duration:t,stagger:n,ease:s,delay:i};return o?F.to(c.lines,{...h,scrollTrigger:{trigger:r,start:"top 75%",once:!0}}):F.to(c.lines,h)}function kn(r,{duration:e=.55,stagger:t=.03,ease:n="power2.out"}={}){return!r||!r.length?null:F.fromTo(r,{opacity:0},{opacity:1,duration:e,stagger:t,ease:n})}async function Ro(r){const e=r?.querySelectorAll("a,p,h1,h2,h3,h4"),t=r?.querySelector(".text-reveal"),n=r?.querySelector(".text-reveal-reverse");if(e?.length&&F.set(e,{opacity:0,clearProps:"transform"}),t){const s=Array.from(e||[]).filter(c=>c!==t),i=cn(t,{direction:"up",animateOnScroll:!1}),o=kn(s);await Promise.all([Et(i),Et(o)]);return}if(n){const s=Array.from(e||[]).filter(c=>c!==n),i=cn(n,{direction:"down",animateOnScroll:!1}),o=kn(s);await Promise.all([Et(i),Et(o)]);return}e?.length&&await Et(kn(Array.from(e)))}function So(){document.querySelectorAll(".text-reveal").forEach(t=>{cn(t,{direction:"up",animateOnScroll:!0})}),document.querySelectorAll(".text-reveal-reverse").forEach(t=>{cn(t,{direction:"down",animateOnScroll:!0})})}F.registerPlugin(gs);function tr(){F.matchMedia().add("(min-width: 992px)",()=>{const e=document.querySelectorAll("[data-animate='font-weight'], [data-animate='font-weight-reverse']"),t=300,n=800,s=500;e.forEach(i=>{const o=er(i),c=i.getAttribute("data-animate")==="font-weight-reverse",a=c?o.chars:o.words;F.set(a,{fontWeight:c?n:s}),i.addEventListener("mousemove",l=>{a.forEach(h=>{const u=h.getBoundingClientRect(),f=u.left+u.width/2,d=u.top+u.height/2,p=Math.hypot(f-l.clientX,d-l.clientY);let m;const g=n-s;c?p<t?m=s+p/t*g:m=n:p<t?m=n-p/t*g:m=s,F.to(h,{duration:.2,ease:"power1.out",fontWeight:m,overwrite:"auto"})})}),i.addEventListener("mouseleave",()=>{const l=c?n:s;a.forEach(h=>{F.to(h,{duration:.5,ease:"power2.out",fontWeight:l,overwrite:"auto"})})})})})}document.addEventListener("DOMContentLoaded",()=>{tr()});var _o=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,bo=/(?:(-)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,Mo=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/ig,Co=/(^[#\.][a-z]|[a-y][a-z])/i,Lo=Math.PI/180,Io=180/Math.PI,Wt=Math.sin,qt=Math.cos,re=Math.abs,_e=Math.sqrt,Po=Math.atan2,ts=1e8,Fs=function(e){return typeof e=="string"},nr=function(e){return typeof e=="number"},No=function(e){return typeof e>"u"},Oo={},Do={},ln=1e5,sr=function(e){return Math.round((e+ts)%1*ln)/ln||(e<0?0:1)},O=function(e){return Math.round(e*ln)/ln||0},ks=function(e){return Math.round(e*1e10)/1e10||0},Bs=function(e){return e.closed=Math.abs(e[0]-e[e.length-2])<.001&&Math.abs(e[1]-e[e.length-1])<.001},Gs=function(e,t,n,s){var i=e[t],o=s===1?6:ns(i,n,s);if((o||!s)&&o+n+2<i.length)return e.splice(t,0,i.slice(0,n+o+2)),i.splice(0,n+o),1},ir=function(e,t,n){var s=e.length,i=~~(n*s);if(e[i]>t){for(;--i&&e[i]>t;);i<0&&(i=0)}else for(;e[++i]<t&&i<s;);return i<s?i:s-1},Fo=function(e,t){var n=e.length;for(e.reverse();n--;)e[n].reversed||Go(e[n])},Hs=function(e,t){return t.totalLength=e.totalLength,e.samples?(t.samples=e.samples.slice(0),t.lookup=e.lookup.slice(0),t.minLength=e.minLength,t.resolution=e.resolution):e.totalPoints&&(t.totalPoints=e.totalPoints),t},ko=function(e,t){var n=e.length,s=e[n-1]||[],i=s.length;n&&t[0]===s[i-2]&&t[1]===s[i-1]&&(t=s.concat(t.slice(2)),n--),e[n]=t};function Zt(r){r=Fs(r)&&Co.test(r)&&document.querySelector(r)||r;var e=r.getAttribute?r:0,t;return e&&(r=r.getAttribute("d"))?(e._gsPath||(e._gsPath={}),t=e._gsPath[r],t&&!t._dirty?t:e._gsPath[r]=un(r)):r?Fs(r)?un(r):nr(r[0])?[r]:r:console.warn("Expecting a <path> element or an SVG path data string")}function Bo(r){for(var e=[],t=0;t<r.length;t++)e[t]=Hs(r[t],r[t].slice(0));return Hs(r,e)}function Go(r){var e=0,t;for(r.reverse();e<r.length;e+=2)t=r[e],r[e]=r[e+1],r[e+1]=t;r.reversed=!r.reversed}var Ho=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","path"),s=[].slice.call(e.attributes),i=s.length,o;for(t=","+t+",";--i>-1;)o=s[i].nodeName.toLowerCase(),t.indexOf(","+o+",")<0&&n.setAttributeNS(null,o,s[i].nodeValue);return n},Uo={rect:"rx,ry,x,y,width,height",circle:"r,cx,cy",ellipse:"rx,ry,cx,cy",line:"x1,x2,y1,y2"},jo=function(e,t){for(var n=t?t.split(","):[],s={},i=n.length;--i>-1;)s[n[i]]=+e.getAttribute(n[i])||0;return s};function Vo(r,e){var t=r.tagName.toLowerCase(),n=.552284749831,s,i,o,c,a,l,h,u,f,d,p,m,g,v,T,x,y,A,w,E,_,R;return t==="path"||!r.getBBox?r:(l=Ho(r,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),R=jo(r,Uo[t]),t==="rect"?(c=R.rx,a=R.ry||c,i=R.x,o=R.y,d=R.width-c*2,p=R.height-a*2,c||a?(m=i+c*(1-n),g=i+c,v=g+d,T=v+c*n,x=v+c,y=o+a*(1-n),A=o+a,w=A+p,E=w+a*n,_=w+a,s="M"+x+","+A+" V"+w+" C"+[x,E,T,_,v,_,v-(v-g)/3,_,g+(v-g)/3,_,g,_,m,_,i,E,i,w,i,w-(w-A)/3,i,A+(w-A)/3,i,A,i,y,m,o,g,o,g+(v-g)/3,o,v-(v-g)/3,o,v,o,T,o,x,y,x,A].join(",")+"z"):s="M"+(i+d)+","+o+" v"+p+" h"+-d+" v"+-p+" h"+d+"z"):t==="circle"||t==="ellipse"?(t==="circle"?(c=a=R.r,u=c*n):(c=R.rx,a=R.ry,u=a*n),i=R.cx,o=R.cy,h=c*n,s="M"+(i+c)+","+o+" C"+[i+c,o+u,i+h,o+a,i,o+a,i-h,o+a,i-c,o+u,i-c,o,i-c,o-u,i-h,o-a,i,o-a,i+h,o-a,i+c,o-u,i+c,o].join(",")+"z"):t==="line"?s="M"+R.x1+","+R.y1+" L"+R.x2+","+R.y2:(t==="polyline"||t==="polygon")&&(f=(r.getAttribute("points")+"").match(bo)||[],i=f.shift(),o=f.shift(),s="M"+i+","+o+" L"+f.join(","),t==="polygon"&&(s+=","+i+","+o+"z")),l.setAttribute("d",ar(l._gsRawPath=un(s))),e&&r.parentNode&&(r.parentNode.insertBefore(l,r),r.parentNode.removeChild(r)),l)}function rr(r,e,t){var n=r[e],s=r[e+2],i=r[e+4],o;return n+=(s-n)*t,s+=(i-s)*t,n+=(s-n)*t,o=s+(i+(r[e+6]-i)*t-s)*t-n,n=r[e+1],s=r[e+3],i=r[e+5],n+=(s-n)*t,s+=(i-s)*t,n+=(s-n)*t,O(Po(s+(i+(r[e+7]-i)*t-s)*t-n,o)*Io)}function or(r,e,t){t=No(t)?1:ks(t)||0,e=ks(e)||0;var n=Math.max(0,~~(re(t-e)-1e-8)),s=Bo(r);if(e>t&&(e=1-e,t=1-t,Fo(s),s.totalLength=0),e<0||t<0){var i=Math.abs(~~Math.min(e,t))+1;e+=i,t+=i}s.totalLength||Ye(s);var o=t>1,c=Us(s,e,Oo,!0),a=Us(s,t,Do),l=a.segment,h=c.segment,u=a.segIndex,f=c.segIndex,d=a.i,p=c.i,m=f===u,g=d===p&&m,v,T,x,y,A,w,E,_;if(o||n){for(v=u<f||m&&d<p||g&&a.t<c.t,Gs(s,f,p,c.t)&&(f++,v||(u++,g?(a.t=(a.t-c.t)/(1-c.t),d=0):m&&(d-=p))),Math.abs(1-(t-e))<1e-5?u=f-1:!a.t&&u?u--:Gs(s,u,d,a.t)&&v&&f++,c.t===1&&(f=(f+1)%s.length),A=[],w=s.length,E=1+w*n,_=f,E+=(w-f+u)%w,y=0;y<E;y++)ko(A,s[_++%w]);s=A}else if(x=a.t===1?6:ns(l,d,a.t),e!==t)for(T=ns(h,p,g?c.t/a.t:c.t),m&&(x+=T),l.splice(d+x+2),(T||p)&&h.splice(0,p+T),y=s.length;y--;)(y<f||y>u)&&s.splice(y,1);else l.angle=rr(l,d+x,0),d+=x,c=l[d],a=l[d+1],l.length=l.totalLength=0,l.totalPoints=s.totalPoints=8,l.push(c,a,c,a,c,a,c,a);return s.totalLength=0,s}function zo(r,e,t){e=e||0,r.samples||(r.samples=[],r.lookup=[]);var n=~~r.resolution||12,s=1/n,i=r.length,o=r[e],c=r[e+1],a=e?e/6*n:0,l=r.samples,h=r.lookup,u=(e?r.minLength:ts)||ts,f=l[a+t*n-1],d=e?l[a-1]:0,p,m,g,v,T,x,y,A,w,E,_,R,S,P,b,D,L;for(l.length=h.length=0,m=e+2;m<i;m+=6){if(g=r[m+4]-o,v=r[m+2]-o,T=r[m]-o,A=r[m+5]-c,w=r[m+3]-c,E=r[m+1]-c,x=y=_=R=0,re(g)<.01&&re(A)<.01&&re(T)+re(E)<.01)r.length>8&&(r.splice(m,6),m-=6,i-=6);else for(p=1;p<=n;p++)P=s*p,S=1-P,x=y-(y=(P*P*g+3*S*(P*v+S*T))*P),_=R-(R=(P*P*A+3*S*(P*w+S*E))*P),D=_e(_*_+x*x),D<u&&(u=D),d+=D,l[a++]=d;o+=g,c+=A}if(f)for(f-=d;a<l.length;a++)l[a]+=f;if(l.length&&u){if(r.totalLength=L=l[l.length-1]||0,r.minLength=u,L/u<9999)for(D=b=0,p=0;p<L;p+=u)h[D++]=l[b]<p?++b:b}else r.totalLength=l[0]=0;return e?d-l[e/2-1]:d}function Ye(r,e){var t,n,s;for(s=t=n=0;s<r.length;s++)r[s].resolution=~~e||12,t+=zo(r[s]),n+=r[s].length;return r.totalPoints=n,r.totalLength=t,r}function ns(r,e,t){if(t<=0||t>=1)return 0;var n=r[e],s=r[e+1],i=r[e+2],o=r[e+3],c=r[e+4],a=r[e+5],l=r[e+6],h=r[e+7],u=n+(i-n)*t,f=i+(c-i)*t,d=s+(o-s)*t,p=o+(a-o)*t,m=u+(f-u)*t,g=d+(p-d)*t,v=c+(l-c)*t,T=a+(h-a)*t;return f+=(v-f)*t,p+=(T-p)*t,r.splice(e+2,4,O(u),O(d),O(m),O(g),O(m+(f-m)*t),O(g+(p-g)*t),O(f),O(p),O(v),O(T)),r.samples&&r.samples.splice(e/6*r.resolution|0,0,0,0,0,0,0,0),6}function Us(r,e,t,n){t=t||{},r.totalLength||Ye(r),(e<0||e>1)&&(e=sr(e));var s=0,i=r[0],o,c,a,l,h,u,f;if(!e)f=u=s=0,i=r[0];else if(e===1)f=1,s=r.length-1,i=r[s],u=i.length-8;else{if(r.length>1){for(a=r.totalLength*e,h=u=0;(h+=r[u++].totalLength)<a;)s=u;i=r[s],l=h-i.totalLength,e=(a-l)/(h-l)||0}o=i.samples,c=i.resolution,a=i.totalLength*e,u=i.lookup.length?i.lookup[~~(a/i.minLength)]||0:ir(o,a,e),l=u?o[u-1]:0,h=o[u],h<a&&(l=h,h=o[++u]),f=1/c*((a-l)/(h-l)+u%c),u=~~(u/c)*6,n&&f===1&&(u+6<i.length?(u+=6,f=0):s+1<r.length&&(u=f=0,i=r[++s]))}return t.t=f,t.i=u,t.path=r,t.segment=i,t.segIndex=s,t}function js(r,e,t,n){var s=r[0],i=n||{},o,c,a,l,h,u,f,d,p;if((e<0||e>1)&&(e=sr(e)),s.lookup||Ye(r),r.length>1){for(a=r.totalLength*e,h=u=0;(h+=r[u++].totalLength)<a;)s=r[u];l=h-s.totalLength,e=(a-l)/(h-l)||0}return o=s.samples,c=s.resolution,a=s.totalLength*e,u=s.lookup.length?s.lookup[e<1?~~(a/s.minLength):s.lookup.length-1]||0:ir(o,a,e),l=u?o[u-1]:0,h=o[u],h<a&&(l=h,h=o[++u]),f=1/c*((a-l)/(h-l)+u%c)||0,p=1-f,u=~~(u/c)*6,d=s[u],i.x=O((f*f*(s[u+6]-d)+3*p*(f*(s[u+4]-d)+p*(s[u+2]-d)))*f+d),i.y=O((f*f*(s[u+7]-(d=s[u+1]))+3*p*(f*(s[u+5]-d)+p*(s[u+3]-d)))*f+d),t&&(i.angle=s.totalLength?rr(s,u,f>=1?1-1e-9:f||1e-9):s.angle||0),i}function St(r,e,t,n,s,i,o){for(var c=r.length,a,l,h,u,f;--c>-1;)for(a=r[c],l=a.length,h=0;h<l;h+=2)u=a[h],f=a[h+1],a[h]=u*e+f*n+i,a[h+1]=u*t+f*s+o;return r._dirty=1,r}function Ko(r,e,t,n,s,i,o,c,a){if(!(r===c&&e===a)){t=re(t),n=re(n);var l=s%360*Lo,h=qt(l),u=Wt(l),f=Math.PI,d=f*2,p=(r-c)/2,m=(e-a)/2,g=h*p+u*m,v=-u*p+h*m,T=g*g,x=v*v,y=T/(t*t)+x/(n*n);y>1&&(t=_e(y)*t,n=_e(y)*n);var A=t*t,w=n*n,E=(A*w-A*x-w*T)/(A*x+w*T);E<0&&(E=0);var _=(i===o?-1:1)*_e(E),R=_*(t*v/n),S=_*-(n*g/t),P=(r+c)/2,b=(e+a)/2,D=P+(h*R-u*S),L=b+(u*R+h*S),B=(g-R)/t,W=(v-S)/n,Ee=(-g-R)/t,Ce=(-v-S)/n,H=B*B+W*W,ue=(W<0?-1:1)*Math.acos(B/_e(H)),Ae=(B*Ce-W*Ee<0?-1:1)*Math.acos((B*Ee+W*Ce)/_e(H*(Ee*Ee+Ce*Ce)));isNaN(Ae)&&(Ae=f),!o&&Ae>0?Ae-=d:o&&Ae<0&&(Ae+=d),ue%=d,Ae%=d;var Cs=Math.ceil(re(Ae)/(d/4)),we=[],zt=Ae/Cs,Kt=4/3*Wt(zt/2)/(1+qt(zt/2)),Mr=h*t,Cr=u*t,Lr=u*-n,Ir=h*n,Y;for(Y=0;Y<Cs;Y++)s=ue+Y*zt,g=qt(s),v=Wt(s),B=qt(s+=zt),W=Wt(s),we.push(g-Kt*v,v+Kt*g,B+Kt*W,W-Kt*B,B,W);for(Y=0;Y<we.length;Y+=2)g=we[Y],v=we[Y+1],we[Y]=g*Mr+v*Lr+D,we[Y+1]=g*Cr+v*Ir+L;return we[Y-2]=c,we[Y-1]=a,we}}function un(r){var e=(r+"").replace(Mo,function(R){var S=+R;return S<1e-4&&S>-1e-4?0:S}).match(_o)||[],t=[],n=0,s=0,i=2/3,o=e.length,c=0,a="ERROR: malformed path: "+r,l,h,u,f,d,p,m,g,v,T,x,y,A,w,E,_=function(S,P,b,D){T=(b-S)/3,x=(D-P)/3,m.push(S+T,P+x,b-T,D-x,b,D)};if(!r||!isNaN(e[0])||isNaN(e[1]))return console.log(a),t;for(l=0;l<o;l++)if(A=d,isNaN(e[l])?(d=e[l].toUpperCase(),p=d!==e[l]):l--,u=+e[l+1],f=+e[l+2],p&&(u+=n,f+=s),l||(g=u,v=f),d==="M")m&&(m.length<8?t.length-=1:c+=m.length,Bs(m)),n=g=u,s=v=f,m=[u,f],t.push(m),l+=2,d="L";else if(d==="C")m||(m=[0,0]),p||(n=s=0),m.push(u,f,n+e[l+3]*1,s+e[l+4]*1,n+=e[l+5]*1,s+=e[l+6]*1),l+=6;else if(d==="S")T=n,x=s,(A==="C"||A==="S")&&(T+=n-m[m.length-4],x+=s-m[m.length-3]),p||(n=s=0),m.push(T,x,u,f,n+=e[l+3]*1,s+=e[l+4]*1),l+=4;else if(d==="Q")T=n+(u-n)*i,x=s+(f-s)*i,p||(n=s=0),n+=e[l+3]*1,s+=e[l+4]*1,m.push(T,x,n+(u-n)*i,s+(f-s)*i,n,s),l+=4;else if(d==="T")T=n-m[m.length-4],x=s-m[m.length-3],m.push(n+T,s+x,u+(n+T*1.5-u)*i,f+(s+x*1.5-f)*i,n=u,s=f),l+=2;else if(d==="H")_(n,s,n=u,s),l+=1;else if(d==="V")_(n,s,n,s=u+(p?s-n:0)),l+=1;else if(d==="L"||d==="Z")d==="Z"&&(u=g,f=v,m.closed=!0),(d==="L"||re(n-u)>.5||re(s-f)>.5)&&(_(n,s,u,f),d==="L"&&(l+=2)),n=u,s=f;else if(d==="A"){if(w=e[l+4],E=e[l+5],T=e[l+6],x=e[l+7],h=7,w.length>1&&(w.length<3?(x=T,T=E,h--):(x=E,T=w.substr(2),h-=2),E=w.charAt(1),w=w.charAt(0)),y=Ko(n,s,+e[l+1],+e[l+2],+e[l+3],+w,+E,(p?n:0)+T*1,(p?s:0)+x*1),l+=h,y)for(h=0;h<y.length;h++)m.push(y[h]);n=m[m.length-2],s=m[m.length-1]}else console.log(a);return l=m.length,l<6?(t.pop(),l=0):Bs(m),t.totalPoints=c+l,t}function Xo(r,e){e===void 0&&(e=1);for(var t=r[0],n=0,s=[t,n],i=2;i<r.length;i+=2)s.push(t,n,r[i],n=(r[i]-t)*e/2,t=r[i],-n);return s}function ss(r,e){re(r[0]-r[2])<1e-4&&re(r[1]-r[3])<1e-4&&(r=r.slice(2));var t=r.length-2,n=+r[0],s=+r[1],i=+r[2],o=+r[3],c=[n,s,n,s],a=i-n,l=o-s,h=r.nonSmooth||[],u=Math.abs(r[t]-n)<.001&&Math.abs(r[t+1]-s)<.001,f,d,p,m,g,v,T,x,y,A,w,E,_,R,S;if(!t)return[n,s,n,s,n,s,n,s];for(u&&(r.push(i,o),i=n,o=s,n=r[t-2],s=r[t-1],r.unshift(n,s),t+=4,h=[0,0].concat(h)),e=e||e===0?+e:1,p=2;p<t;p+=2)if(f=n,d=s,n=i,s=o,i=+r[p+2],o=+r[p+3],!(n===i&&s===o)){if(m=a,g=l,a=i-n,l=o-s,h[p]){c.push(n-(n-f)/4,s-(s-d)/4,n,s,n+(i-n)/4,s+(o-s)/4);continue}v=_e(m*m+g*g),T=_e(a*a+l*l),x=_e(Math.pow(a/T+m/v,2)+Math.pow(l/T+g/v,2)),y=(v+T)*e*.25/x,A=n-(n-f)*(v?y/v:0),w=n+(i-n)*(T?y/T:0),E=n-(A+((w-A)*(v*3/(v+T)+.5)/4||0)),_=s-(s-d)*(v?y/v:0),R=s+(o-s)*(T?y/T:0),S=s-(_+((R-_)*(v*3/(v+T)+.5)/4||0)),c.push(O(A+E),O(_+S),O(n),O(s),O(w+E),O(R+S))}return n!==i||s!==o||c.length<4?c.push(O(i),O(o),O(i),O(o)):c.length-=2,c.length===2?c.push(n,s,n,s,n,s):u&&(c.splice(0,6),c.length-=6),c.closed=u,c}function ar(r){nr(r[0])&&(r=[r]);var e="",t=r.length,n,s,i,o;for(s=0;s<t;s++){for(o=r[s],e+="M"+O(o[0])+","+O(o[1])+" C",n=o.length,i=2;i<n;i++)e+=O(o[i++])+","+O(o[i++])+" "+O(o[i++])+","+O(o[i++])+" "+O(o[i++])+","+O(o[i])+" ";o.closed&&(e+="z")}return e}var Wo="x,translateX,left,marginLeft,xPercent".split(","),qo="y,translateY,top,marginTop,yPercent".split(","),$o=Math.PI/180,ne,cr,rt,is,Bn,Vs,Yo=function(){return ne||typeof window<"u"&&(ne=window.gsap)&&ne.registerPlugin&&ne},At=function(e,t,n,s){for(var i=t.length,o=s===2?0:s,c=0;c<i;c++)e[o]=parseFloat(t[c][n]),s===2&&(e[o+1]=0),o+=2;return e},lt=function(e,t,n){return parseFloat(e._gsap.get(e,t,n||"px"))||0},lr=function(e){var t=e[0],n=e[1],s;for(s=2;s<e.length;s+=2)t=e[s]+=t,n=e[s+1]+=n},zs=function(e,t,n,s,i,o,c,a,l){if(c.type==="cubic")t=[t];else{c.fromCurrent!==!1&&t.unshift(lt(n,s,a),i?lt(n,i,l):0),c.relative&&lr(t);var h=i?ss:Xo;t=[h(t,c.curviness)]}return t=o(ur(t,n,c)),hn(e,n,s,t,"x",a),i&&hn(e,n,i,t,"y",l),Ye(t,c.resolution||(c.curviness===0?20:12))},Qo=function(e){return e},Zo=/[-+\.]*\d+\.?(?:e-|e\+)?\d*/g,Ks=function(e,t,n){var s=ut(e),i=0,o=0,c;return(e.tagName+"").toLowerCase()==="svg"?(c=e.viewBox.baseVal,c.width||(c={width:+e.getAttribute("width"),height:+e.getAttribute("height")})):c=t&&e.getBBox&&e.getBBox(),t&&t!=="auto"&&(i=t.push?t[0]*(c?c.width:e.offsetWidth||0):t.x,o=t.push?t[1]*(c?c.height:e.offsetHeight||0):t.y),n.apply(i||o?s.apply({x:i,y:o}):{x:s.e,y:s.f})},rs=function(e,t,n,s){var i=ut(e.parentNode,!0,!0),o=i.clone().multiply(ut(t)),c=Ks(e,n,i),a=Ks(t,s,i),l=a.x,h=a.y,u;return o.e=o.f=0,s==="auto"&&t.getTotalLength&&t.tagName.toLowerCase()==="path"&&(u=t.getAttribute("d").match(Zo)||[],u=o.apply({x:+u[0],y:+u[1]}),l+=u.x,h+=u.y),u&&(u=o.apply(t.getBBox()),l-=u.x,h-=u.y),o.e=l-c.x,o.f=h-c.y,o},ur=function(e,t,n){var s=n.align,i=n.matrix,o=n.offsetX,c=n.offsetY,a=n.alignOrigin,l=e[0][0],h=e[0][1],u=lt(t,"x"),f=lt(t,"y"),d,p,m;return!e||!e.length?Zt("M0,0L0,0"):(s&&(s==="self"||(d=is(s)[0]||t)===t?St(e,1,0,0,1,u-l,f-h):(a&&a[2]!==!1?ne.set(t,{transformOrigin:a[0]*100+"% "+a[1]*100+"%"}):a=[lt(t,"xPercent")/-100,lt(t,"yPercent")/-100],p=rs(t,d,a,"auto"),m=p.apply({x:l,y:h}),St(e,p.a,p.b,p.c,p.d,u+p.e-(m.x-p.e),f+p.f-(m.y-p.f)))),i?St(e,i.a,i.b,i.c,i.d,i.e,i.f):(o||c)&&St(e,1,0,0,1,o||0,c||0),e)},hn=function(e,t,n,s,i,o){var c=t._gsap,a=c.harness,l=a&&a.aliases&&a.aliases[n],h=l&&l.indexOf(",")<0?l:n,u=e._pt=new cr(e._pt,t,h,0,0,Qo,0,c.set(t,h,e));u.u=rt(c.get(t,h,o))||0,u.path=s,u.pp=i,e._props.push(h)},Jo=function(e,t){return function(n){return e||t!==1?or(n,e,t):n}},hr={version:"3.14.2",name:"motionPath",register:function(e,t,n){ne=e,rt=ne.utils.getUnit,is=ne.utils.toArray,Bn=ne.core.getStyleSaver,Vs=ne.core.reverting||function(){},cr=n},init:function(e,t,n){if(!ne)return console.warn("Please gsap.registerPlugin(MotionPathPlugin)"),!1;(!(typeof t=="object"&&!t.style)||!t.path)&&(t={path:t});var s=[],i=t,o=i.path,c=i.autoRotate,a=i.unitX,l=i.unitY,h=i.x,u=i.y,f=o[0],d=Jo(t.start,"end"in t?t.end:1),p,m;if(this.rawPaths=s,this.target=e,this.tween=n,this.styles=Bn&&Bn(e,"transform"),(this.rotate=c||c===0)&&(this.rOffset=parseFloat(c)||0,this.radians=!!t.useRadians,this.rProp=t.rotation||"rotation",this.rSet=e._gsap.set(e,this.rProp,this),this.ru=rt(e._gsap.get(e,this.rProp))||0),Array.isArray(o)&&!("closed"in o)&&typeof f!="number"){for(m in f)!h&&~Wo.indexOf(m)?h=m:!u&&~qo.indexOf(m)&&(u=m);h&&u?s.push(zs(this,At(At([],o,h,0),o,u,1),e,h,u,d,t,a||rt(o[0][h]),l||rt(o[0][u]))):h=u=0;for(m in f)m!==h&&m!==u&&s.push(zs(this,At([],o,m,2),e,m,0,d,t,rt(o[0][m])))}else p=d(ur(Zt(t.path),e,t)),Ye(p,t.resolution),s.push(p),hn(this,e,t.x||"x",p,"x",t.unitX||"px"),hn(this,e,t.y||"y",p,"y",t.unitY||"px");n.vars.immediateRender&&this.render(n.progress(),this)},render:function(e,t){var n=t.rawPaths,s=n.length,i=t._pt;if(t.tween._time||!Vs()){for(e>1?e=1:e<0&&(e=0);s--;)js(n[s],e,!s&&t.rotate,n[s]);for(;i;)i.set(i.t,i.p,i.path[i.pp]+i.u,i.d,e),i=i._next;t.rotate&&t.rSet(t.target,t.rProp,n[0].angle*(t.radians?$o:1)+t.rOffset+t.ru,t,e)}else t.styles.revert()},getLength:function(e){return Ye(Zt(e)).totalLength},sliceRawPath:or,getRawPath:Zt,pointsToSegment:ss,stringToRawPath:un,rawPathToString:ar,transformRawPath:St,getGlobalMatrix:ut,getPositionOnPath:js,cacheRawPathMeasurements:Ye,convertToPath:function(e,t){return is(e).map(function(n){return Vo(n,t!==!1)})},convertCoordinates:function(e,t,n){var s=ut(t,!0,!0).multiply(ut(e));return n?s.apply(n):s},getAlignMatrix:rs,getRelativePosition:function(e,t,n,s){var i=rs(e,t,n,s);return{x:i.e,y:i.f}},arrayToRawPath:function(e,t){t=t||{};var n=At(At([],e,t.x||"x",0),e,t.y||"y",1);return t.relative&&lr(n),[t.type==="cubic"?n:ss(n,t.curviness)]}};Yo()&&ne.registerPlugin(hr);const Ot=[{title:"Blurred Vision",image:"/work/work-1.jpg",href:"/film.html"},{title:"Silent Motion",image:"/work/work-2.jpg",href:"/archive.html"},{title:"Red Mirage",image:"/work/work-3.jpg",href:"/about.html"},{title:"Echoed Silhouette",image:"/work/work-4.jpg",href:"/contact.html"}];F.registerPlugin(hr);let xt,Fe,xe;const ft={passive:!1},ws=Ot.length,et=ws*5,ea=5;let ae=window.innerWidth*.45,Rs=window.innerWidth/2,Ss=window.innerWidth<1e3,Jt=null,fe=0,_t=0,Xs,Dt=!1,oe=null;const ta=.2,na="power2.out",sa=.05,$t=Math.PI*2;function _s(){return Ss?150:350}function ia(){return-(Math.abs(fe)/ae*(360/et))+90}function ra({cx:r,cy:e,radius:t,fromAngle:n,toAngle:s,steps:i=14}){const o=h=>{let u=h;for(;u<0;)u+=$t;for(;u>=$t;)u-=$t;return u},c=o(n);let a=o(s);a>c&&(a-=$t);const l=[];for(let h=1;h<=i;h++){const u=h/i,f=c+(a-c)*u;l.push({x:r+t*Math.cos(f),y:e+t*Math.sin(f)})}return l}function oa(){if(xt)for(let r=0;r<et*3;r++){const e=document.createElement("div");e.className="slide";const t=document.createElement("img"),n=Ot[r%ws];t.src=n.image,e.appendChild(t),xt.appendChild(e)}}function fr({atOrigin:r=!1}={}){if(xe)for(let e=0;e<et;e++){const t=e/et*Math.PI*2,n=_s(),s=document.createElement("div");s.className="thumbnail-item",s.dataset.index=e,s.dataset.angle=t,s.dataset.radius=n;const i=document.createElement("img"),o=Ot[e%ws];if(i.src=o.image,s.appendChild(i),r)F.set(s,{x:window.innerWidth/2,y:window.innerHeight,xPercent:-50,yPercent:-100,transformOrigin:"center center"});else{const c=n*Math.cos(t)+window.innerWidth/2,a=n*Math.sin(t)+window.innerHeight/2-25;F.set(s,{x:c,y:a,transformOrigin:"center center"})}xe.appendChild(s)}}function dr(){document.querySelectorAll(".slide").forEach((t,n)=>{const s=n*ae-ae;F.set(t,{x:s})});const e=window.innerWidth/2-ae/2;fe=e,_t=e}function fn(r){const e=r.deltaY||r.detail||r.wheelDelta*-1;_t-=e*1,clearTimeout(Xs),Xs=setTimeout(()=>{},150)}function pr(){fe+=(_t-fe)*.1;const r=et*ae;fe>0?(fe-=r,_t-=r):fe<-r&&(fe+=r,_t+=r);let e=0,t=1/0;document.querySelectorAll(".slide").forEach((o,c)=>{const a=c*ae+fe;F.set(o,{x:a});const l=a+ae/2,h=Math.abs(l-Rs),u=ae*3,f=Math.min(h/u,1),p=1+(f<.5?2*f*f:1-Math.pow(-2*f+2,2)/2)*(ea-1),m=o.querySelector("img");F.set(m,{scale:p}),h<t&&(t=h,e=c%et)});const s=e%Ot.length,i=Ot[s];Fe.textContent=i.title,Fe.dataset.href=i.href||"",Dt||mr(),Jt=requestAnimationFrame(pr)}function mr(){const e=-(Math.abs(fe)/ae*(360/et))+90;document.querySelectorAll(".thumbnail-item").forEach(n=>{const s=parseFloat(n.dataset.angle),i=_s(),o=s+e*Math.PI/180,c=i*Math.cos(o)+window.innerWidth/2,a=i*Math.sin(o)+window.innerHeight/2-25;F.set(n,{x:c,y:a,rotation:0,transformOrigin:"center center"})})}function aa(){if(!xe)return;const r=Array.from(xe.querySelectorAll(".thumbnail-item"));if(r.length===0)return;oe&&(oe.kill(),oe=null),Dt=!0;const e=window.innerWidth/2,t=window.innerHeight/2-25,n=_s(),s={x:e,y:window.innerHeight},i={x:e,y:t+n},o=Math.PI/2,a=ia()*Math.PI/180;oe=F.timeline({delay:ta,defaults:{ease:na},onComplete:()=>{r.forEach(l=>F.set(l,{xPercent:0,yPercent:0})),mr(),Dt=!1}}),r.forEach((l,h)=>{const f=parseFloat(l.dataset.angle)+a,d=ra({cx:e,cy:t,radius:n,fromAngle:o,toAngle:f}),p=[s,i,...d],m=d[d.length-1]||i;oe.to(l,{duration:1.1,x:m.x,y:m.y,yPercent:-50,motionPath:{path:p,curviness:1.2}},h*sa)})}function gr(r){(r.target===document||r.target===document.body)&&window.scrollTo(0,0)}function vr(){oe&&(oe.kill(),oe=null),Dt=!1,Ss=window.innerWidth<1e3,ae=window.innerWidth*.45,Rs=window.innerWidth/2,xe&&(xe.innerHTML=""),fr(),dr()}function ca(){window.addEventListener("wheel",fn,ft),window.addEventListener("DOMMouseScroll",fn,ft),window.addEventListener("scroll",gr,ft),window.addEventListener("resize",vr)}function dn(){oe&&(oe.kill(),oe=null),Dt=!1,Jt&&(cancelAnimationFrame(Jt),Jt=null),window.removeEventListener("wheel",fn,ft),window.removeEventListener("DOMMouseScroll",fn,ft),window.removeEventListener("scroll",gr,ft),window.removeEventListener("resize",vr),Fe&&(Fe.onclick=null),xt&&(xt.innerHTML=""),xe&&(xe.innerHTML="")}function la(){dn(),xt=document.querySelector(".slider"),Fe=document.querySelector(".slide-title"),xe=document.querySelector(".thumbnail-wheel"),!(!xt||!Fe||!xe)&&(ae=window.innerWidth*.45,Rs=window.innerWidth/2,Ss=window.innerWidth<1e3,oa(),fr({atOrigin:!0}),dr(),ca(),aa(),Fe.onclick=()=>{const r=Fe.dataset.href;r&&(window.location.href=r)},pr())}const ua=parseInt(hi.replace(/\D+/g,""));function Ws(r,e){if(e===fi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===gt||e===An){let t=r.getIndex();if(t===null){const o=[],c=r.getAttribute("position");if(c!==void 0){for(let a=0;a<c.count;a++)o.push(a);r.setIndex(o),t=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const n=t.count-2,s=[];if(t)if(e===gt)for(let o=1;o<=n;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=r.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}function pn(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let e="";for(let t=0,n=r.length;t<n;t++)e+=String.fromCharCode(r[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const $e="srgb",be="srgb-linear",qs=3001,ha=3e3;let fa=class extends di{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new va(t)}),this.register(function(t){return new Ta(t)}),this.register(function(t){return new ba(t)}),this.register(function(t){return new Ma(t)}),this.register(function(t){return new Ca(t)}),this.register(function(t){return new ya(t)}),this.register(function(t){return new Ea(t)}),this.register(function(t){return new Aa(t)}),this.register(function(t){return new wa(t)}),this.register(function(t){return new ga(t)}),this.register(function(t){return new Ra(t)}),this.register(function(t){return new xa(t)}),this.register(function(t){return new _a(t)}),this.register(function(t){return new Sa(t)}),this.register(function(t){return new pa(t)}),this.register(function(t){return new La(t)}),this.register(function(t){return new Ia(t)})}load(e,t,n,s){const i=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=ve.extractUrlBase(e);o=ve.resolveURL(l,this.path)}else o=ve.extractUrlBase(e);this.manager.itemStart(e);const c=function(l){s?s(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},a=new wn(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i.parse(l,o,function(h){t(h),i.manager.itemEnd(e)},c)}catch(h){c(h)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let i;const o={},c={};if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(pn(new Uint8Array(e.slice(0,4)))===Tr){try{o[M.KHR_BINARY_GLTF]=new Pa(e)}catch(h){s&&s(h);return}i=JSON.parse(o[M.KHR_BINARY_GLTF].content)}else i=JSON.parse(pn(new Uint8Array(e)));else i=e;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new Ka(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const h=this.pluginCallbacks[l](a);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[h.name]=h,o[h.name]=!0}if(i.extensionsUsed)for(let l=0;l<i.extensionsUsed.length;++l){const h=i.extensionsUsed[l],u=i.extensionsRequired||[];switch(h){case M.KHR_MATERIALS_UNLIT:o[h]=new ma;break;case M.KHR_DRACO_MESH_COMPRESSION:o[h]=new Na(i,this.dracoLoader);break;case M.KHR_TEXTURE_TRANSFORM:o[h]=new Oa;break;case M.KHR_MESH_QUANTIZATION:o[h]=new Da;break;default:u.indexOf(h)>=0&&c[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}a.setExtensions(o),a.setPlugins(c),a.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,i){n.parse(e,t,s,i)})}};function da(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const M={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let pa=class{constructor(e){this.parser=e,this.name=M.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const h=new K(16777215);a.color!==void 0&&h.setRGB(a.color[0],a.color[1],a.color[2],be);const u=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Rn(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new mi(h),l.distance=u;break;case"spot":l=new pi(h),l.distance=u,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,Re(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],c=(i.extensions&&i.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(a){return n._getNodeRef(t.cache,c,a)})}},ma=class{constructor(){this.name=M.KHR_MATERIALS_UNLIT}getMaterialType(){return de}extendParams(e,t,n){const s=[];e.color=new K(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],be),e.opacity=o[3]}i.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",i.baseColorTexture,$e))}return Promise.all(s)}},ga=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}},va=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new z(c,c)}return Promise.all(i)}},Ta=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}},xa=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}},ya=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new K(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const c=o.sheenColorFactor;t.sheenColor.setRGB(c[0],c[1],c[2],be)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,$e)),o.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}},Ea=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}},Aa=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const c=o.attenuationColor||[1,1,1];return t.attenuationColor=new K().setRGB(c[0],c[1],c[2],be),Promise.all(i)}},wa=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},Ra=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return t.specularColor=new K().setRGB(c[0],c[1],c[2],be),o.specularColorTexture!==void 0&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,$e)),Promise.all(i)}},Sa=class{constructor(e){this.parser=e,this.name=M.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&i.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(i)}},_a=class{constructor(e){this.parser=e,this.name=M.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}},ba=class{constructor(e){this.parser=e,this.name=M.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}},Ma=class{constructor(e){this.parser=e,this.name=M.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],c=s.images[o.source];let a=n.textureLoader;if(c.uri){const l=n.options.manager.getHandler(c.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},Ca=class{constructor(e){this.parser=e,this.name=M.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],c=s.images[o.source];let a=n.textureLoader;if(c.uri){const l=n.options.manager.getHandler(c.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},La=class{constructor(e){this.name=M.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(c){const a=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,f=new Uint8Array(c,a,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,f,s.mode,s.filter).then(function(d){return d.buffer}):o.ready.then(function(){const d=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(d),h,u,f,s.mode,s.filter),d})})}else return null}},Ia=class{constructor(e){this.name=M.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const l of s.primitives)if(l.mode!==ee.TRIANGLES&&l.mode!==ee.TRIANGLE_STRIP&&l.mode!==ee.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=n.extensions[this.name].attributes,c=[],a={};for(const l in o)c.push(this.parser.getDependency("accessor",o[l]).then(h=>(a[l]=h,a[l])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(l=>{const h=l.pop(),u=h.isGroup?h.children:[h],f=l[0].count,d=[];for(const p of u){const m=new Ge,g=new ie,v=new Sn,T=new ie(1,1,1),x=new gi(p.geometry,p.material,f);for(let y=0;y<f;y++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,y),a.ROTATION&&v.fromBufferAttribute(a.ROTATION,y),a.SCALE&&T.fromBufferAttribute(a.SCALE,y),x.setMatrixAt(y,m.compose(g,v,T));for(const y in a)if(y==="_COLOR_0"){const A=a[y];x.instanceColor=new vi(A.array,A.itemSize,A.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,a[y]);_n.prototype.copy.call(x,p),this.parser.assignFinalMaterial(x),d.push(x)}return h.isGroup?(h.clear(),h.add(...d),h):d[0]}))}};const Tr="glTF",wt=12,$s={JSON:1313821514,BIN:5130562};let Pa=class{constructor(e){this.name=M.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,wt);if(this.header={magic:pn(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Tr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-wt,s=new DataView(e,wt);let i=0;for(;i<n;){const o=s.getUint32(i,!0);i+=4;const c=s.getUint32(i,!0);if(i+=4,c===$s.JSON){const a=new Uint8Array(e,wt+i,o);this.content=pn(a)}else if(c===$s.BIN){const a=wt+i;this.body=e.slice(a,a+o)}i+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Na=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=M.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},a={},l={};for(const h in o){const u=os[h]||h.toLowerCase();c[u]=o[h]}for(const h in e.attributes){const u=os[h]||h.toLowerCase();if(o[h]!==void 0){const f=n.accessors[e.attributes[h]],d=dt[f.componentType];l[u]=d.name,a[u]=f.normalized===!0}}return t.getDependency("bufferView",i).then(function(h){return new Promise(function(u,f){s.decodeDracoFile(h,function(d){for(const p in d.attributes){const m=d.attributes[p],g=a[p];g!==void 0&&(m.normalized=g)}u(d)},c,l,be,f)})})}},Oa=class{constructor(){this.name=M.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Da=class{constructor(){this.name=M.KHR_MESH_QUANTIZATION}},xr=class extends Bi{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,i=e*s*3+s;for(let o=0;o!==s;o++)t[o]=n[i+o];return t}interpolate_(e,t,n,s){const i=this.resultBuffer,o=this.sampleValues,c=this.valueSize,a=c*2,l=c*3,h=s-t,u=(n-t)/h,f=u*u,d=f*u,p=e*l,m=p-l,g=-2*d+3*f,v=d-f,T=1-g,x=v-f+u;for(let y=0;y!==c;y++){const A=o[m+y+c],w=o[m+y+a]*h,E=o[p+y+c],_=o[p+y]*h;i[y]=T*A+x*w+g*E+v*_}return i}};const Fa=new Sn;let ka=class extends xr{interpolate_(e,t,n,s){const i=super.interpolate_(e,t,n,s);return Fa.fromArray(i).normalize().toArray(i),i}};const ee={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},dt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ys={9728:Lt,9729:Q,9984:Ai,9985:Ei,9986:yi,9987:bn},Qs={33071:vt,33648:wi,10497:He},Gn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},os={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...ua>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Le={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ba={CUBICSPLINE:void 0,LINEAR:Ln,STEP:Fi},Hn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ga(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new Mn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ts})),r.DefaultMaterial}function je(r,e,t){for(const n in t.extensions)r[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Re(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ha(r,e,t){let n=!1,s=!1,i=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(i=!0),n&&s&&i)break}if(!n&&!s&&!i)return Promise.resolve(r);const o=[],c=[],a=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):r.attributes.position;o.push(f)}if(s){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):r.attributes.normal;c.push(f)}if(i){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):r.attributes.color;a.push(f)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(a)]).then(function(l){const h=l[0],u=l[1],f=l[2];return n&&(r.morphAttributes.position=h),s&&(r.morphAttributes.normal=u),i&&(r.morphAttributes.color=f),r.morphTargetsRelative=!0,r})}function Ua(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)r.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(r.morphTargetInfluences.length===t.length){r.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)r.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ja(r){let e;const t=r.extensions&&r.extensions[M.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Un(t.attributes):e=r.indices+":"+Un(r.attributes)+":"+r.mode,r.targets!==void 0)for(let n=0,s=r.targets.length;n<s;n++)e+=":"+Un(r.targets[n]);return e}function Un(r){let e="";const t=Object.keys(r).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+r[t[n]]+";";return e}function as(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Va(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const za=new Ge;let Ka=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new da,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,i=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,i=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&i<98?this.textureLoader=new vs(this.options.manager):this.textureLoader=new Ti(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new wn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const c={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:n,userData:{}};return je(i,c,s),Re(c,s),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(c)})).then(function(){for(const a of c.scenes)a.updateMatrixWorld();e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,i=t.length;s<i;s++){const o=t[s].joints;for(let c=0,a=o.length;c<a;c++)e[o[c]].isBone=!0}for(let s=0,i=e.length;s<i;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),i=(o,c)=>{const a=this.associations.get(o);a!=null&&this.associations.set(c,a);for(const[l,h]of o.children.entries())i(h,c.children[l])};return i(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const i=e(t[s]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(i,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[M.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,o){n.load(ve.resolveURL(t.uri,s.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,i=t.byteOffset||0;return n.slice(i,i+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Gn[s.type],c=dt[s.componentType],a=s.normalized===!0,l=new c(s.count*o);return Promise.resolve(new ke(l,o,a))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(o){const c=o[0],a=Gn[s.type],l=dt[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*a,f=s.byteOffset||0,d=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let m,g;if(d&&d!==u){const v=Math.floor(f/d),T="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let x=t.cache.get(T);x||(m=new l(c,v*d,s.count*d/h),x=new xi(m,d/h),t.cache.add(T,x)),g=new ki(x,a,f%d/h,p)}else c===null?m=new l(s.count*a):m=new l(c,f,s.count*a),g=new ke(m,a,p);if(s.sparse!==void 0){const v=Gn.SCALAR,T=dt[s.sparse.indices.componentType],x=s.sparse.indices.byteOffset||0,y=s.sparse.values.byteOffset||0,A=new T(o[1],x,s.sparse.count*v),w=new l(o[2],y,s.sparse.count*a);c!==null&&(g=new ke(g.array.slice(),g.itemSize,g.normalized));for(let E=0,_=A.length;E<_;E++){const R=A[E];if(g.setX(R,w[E*a]),a>=2&&g.setY(R,w[E*a+1]),a>=3&&g.setZ(R,w[E*a+2]),a>=4&&g.setW(R,w[E*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let c=this.textureLoader;if(o.uri){const a=n.manager.getHandler(o.uri);a!==null&&(c=a)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,t,n){const s=this,i=this.json,o=i.textures[e],c=i.images[t],a=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=o.name||c.name||"",h.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(h.name=c.uri);const f=(i.samplers||{})[o.sampler]||{};return h.magFilter=Ys[f.magFilter]||Q,h.minFilter=Ys[f.minFilter]||bn,h.wrapS=Qs[f.wrapS]||He,h.wrapT=Qs[f.wrapT]||He,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,s=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=s.images[e],c=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(o.bufferView!==void 0)a=n.getDependency("bufferView",o.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:o.mimeType});return a=c.createObjectURL(f),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then(function(u){return new Promise(function(f,d){let p=f;t.isImageBitmapLoader===!0&&(p=function(m){const g=new Je(m);g.needsUpdate=!0,f(g)}),t.load(ve.resolveURL(u,i.path),p,void 0,d)})}).then(function(u){return l===!0&&c.revokeObjectURL(a),Re(u,o),u.userData.mimeType=o.mimeType||Va(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,s){const i=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),i.extensions[M.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[M.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const a=i.associations.get(o);o=i.extensions[M.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),i.associations.set(o,a)}}return s!==void 0&&(typeof s=="number"&&(s=s===qs?$e:be),"colorSpace"in o?o.colorSpace=s:o.encoding=s===$e?qs:ha),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let a=this.cache.get(c);a||(a=new Ri,Be.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(c,a)),n=a}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let a=this.cache.get(c);a||(a=new Si,Be.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,this.cache.add(c,a)),n=a}if(s||i||o){let c="ClonedMaterial:"+n.uuid+":";s&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let a=this.cache.get(c);a||(a=n.clone(),i&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(c,a),this.associations.set(a,this.associations.get(n))),n=a}e.material=n}getMaterialType(){return Mn}loadMaterial(e){const t=this,n=this.json,s=this.extensions,i=n.materials[e];let o;const c={},a=i.extensions||{},l=[];if(a[M.KHR_MATERIALS_UNLIT]){const u=s[M.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),l.push(u.extendParams(c,i,t))}else{const u=i.pbrMetallicRoughness||{};if(c.color=new K(1,1,1),c.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;c.color.setRGB(f[0],f[1],f[2],be),c.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(c,"map",u.baseColorTexture,$e)),c.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,c.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(c,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(c,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,c)})))}i.doubleSided===!0&&(c.side=at);const h=i.alphaMode||Hn.OPAQUE;if(h===Hn.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,h===Hn.MASK&&(c.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==de&&(l.push(t.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new z(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;c.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&o!==de&&(l.push(t.assignTexture(c,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==de){const u=i.emissiveFactor;c.emissive=new K().setRGB(u[0],u[1],u[2],be)}return i.emissiveTexture!==void 0&&o!==de&&l.push(t.assignTexture(c,"emissiveMap",i.emissiveTexture,$e)),Promise.all(l).then(function(){const u=new o(c);return i.name&&(u.name=i.name),Re(u,i),t.associations.set(u,{materials:e}),i.extensions&&je(s,u,i),u})}createUniqueName(e){const t=_i.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function i(c){return n[M.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(a){return Zs(a,c,t)})}const o=[];for(let c=0,a=e.length;c<a;c++){const l=e[c],h=ja(l),u=s[h];if(u)o.push(u.promise);else{let f;l.extensions&&l.extensions[M.KHR_DRACO_MESH_COMPRESSION]?f=i(l):f=Zs(new Cn,l,t),s[h]={primitive:l,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,s=this.extensions,i=n.meshes[e],o=i.primitives,c=[];for(let a=0,l=o.length;a<l;a++){const h=o[a].material===void 0?Ga(this.cache):this.getDependency("material",o[a].material);c.push(h)}return c.push(t.loadGeometries(o)),Promise.all(c).then(function(a){const l=a.slice(0,a.length-1),h=a[a.length-1],u=[];for(let d=0,p=h.length;d<p;d++){const m=h[d],g=o[d];let v;const T=l[d];if(g.mode===ee.TRIANGLES||g.mode===ee.TRIANGLE_STRIP||g.mode===ee.TRIANGLE_FAN||g.mode===void 0)v=i.isSkinnedMesh===!0?new bi(m,T):new Gt(m,T),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),g.mode===ee.TRIANGLE_STRIP?v.geometry=Ws(v.geometry,An):g.mode===ee.TRIANGLE_FAN&&(v.geometry=Ws(v.geometry,gt));else if(g.mode===ee.LINES)v=new Mi(m,T);else if(g.mode===ee.LINE_STRIP)v=new Ci(m,T);else if(g.mode===ee.LINE_LOOP)v=new Li(m,T);else if(g.mode===ee.POINTS)v=new Ii(m,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(v.geometry.morphAttributes).length>0&&Ua(v,i),v.name=t.createUniqueName(i.name||"mesh_"+e),Re(v,i),g.extensions&&je(s,v,g),t.assignFinalMaterial(v),u.push(v)}for(let d=0,p=u.length;d<p;d++)t.associations.set(u[d],{meshes:e,primitives:d});if(u.length===1)return i.extensions&&je(s,u[0],i),u[0];const f=new ht;i.extensions&&je(s,f,i),t.associations.set(f,{meshes:e});for(let d=0,p=u.length;d<p;d++)f.add(u[d]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Ht(Pi.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new Ut(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Re(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,i=t.joints.length;s<i;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const i=s.pop(),o=s,c=[],a=[];for(let l=0,h=o.length;l<h;l++){const u=o[l];if(u){c.push(u);const f=new Ge;i!==null&&f.fromArray(i.array,l*16),a.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Ni(c,a)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],i=s.name?s.name:"animation_"+e,o=[],c=[],a=[],l=[],h=[];for(let u=0,f=s.channels.length;u<f;u++){const d=s.channels[u],p=s.samplers[d.sampler],m=d.target,g=m.node,v=s.parameters!==void 0?s.parameters[p.input]:p.input,T=s.parameters!==void 0?s.parameters[p.output]:p.output;m.node!==void 0&&(o.push(this.getDependency("node",g)),c.push(this.getDependency("accessor",v)),a.push(this.getDependency("accessor",T)),l.push(p),h.push(m))}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(a),Promise.all(l),Promise.all(h)]).then(function(u){const f=u[0],d=u[1],p=u[2],m=u[3],g=u[4],v=[];for(let T=0,x=f.length;T<x;T++){const y=f[T],A=d[T],w=p[T],E=m[T],_=g[T];if(y===void 0)continue;y.updateMatrix&&y.updateMatrix();const R=n._createAnimationTracks(y,A,w,E,_);if(R)for(let S=0;S<R.length;S++)v.push(R[S])}return new Oi(i,void 0,v)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(i){const o=n._getNodeRef(n.meshCache,s.mesh,i);return s.weights!==void 0&&o.traverse(function(c){if(c.isMesh)for(let a=0,l=s.weights.length;a<l;a++)c.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],i=n._loadNodeShallow(e),o=[],c=s.children||[];for(let l=0,h=c.length;l<h;l++)o.push(n.getDependency("node",c[l]));const a=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([i,Promise.all(o),a]).then(function(l){const h=l[0],u=l[1],f=l[2];f!==null&&h.traverse(function(d){d.isSkinnedMesh&&d.bind(f,za)});for(let d=0,p=u.length;d<p;d++)h.add(u[d]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],o=i.name?s.createUniqueName(i.name):"",c=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&c.push(a),i.camera!==void 0&&c.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){c.push(l)}),this.nodeCache[e]=Promise.all(c).then(function(l){let h;if(i.isBone===!0?h=new Di:l.length>1?h=new ht:l.length===1?h=l[0]:h=new _n,h!==l[0])for(let u=0,f=l.length;u<f;u++)h.add(l[u]);if(i.name&&(h.userData.name=i.name,h.name=o),Re(h,i),i.extensions&&je(n,h,i),i.matrix!==void 0){const u=new Ge;u.fromArray(i.matrix),h.applyMatrix4(u)}else i.translation!==void 0&&h.position.fromArray(i.translation),i.rotation!==void 0&&h.quaternion.fromArray(i.rotation),i.scale!==void 0&&h.scale.fromArray(i.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,i=new ht;n.name&&(i.name=s.createUniqueName(n.name)),Re(i,n),n.extensions&&je(t,i,n);const o=n.nodes||[],c=[];for(let a=0,l=o.length;a<l;a++)c.push(s.getDependency("node",o[a]));return Promise.all(c).then(function(a){for(let h=0,u=a.length;h<u;h++)i.add(a[h]);const l=h=>{const u=new Map;for(const[f,d]of s.associations)(f instanceof Be||f instanceof Je)&&u.set(f,d);return h.traverse(f=>{const d=s.associations.get(f);d!=null&&u.set(f,d)}),u};return s.associations=l(i),i})}_createAnimationTracks(e,t,n,s,i){const o=[],c=e.name?e.name:e.uuid,a=[];Le[i.path]===Le.weights?e.traverse(function(f){f.morphTargetInfluences&&a.push(f.name?f.name:f.uuid)}):a.push(c);let l;switch(Le[i.path]){case Le.weights:l=sn;break;case Le.rotation:l=rn;break;case Le.position:case Le.scale:l=nn;break;default:n.itemSize===1?l=sn:l=nn;break}const h=s.interpolation!==void 0?Ba[s.interpolation]:Ln,u=this._getArrayFromAccessor(n);for(let f=0,d=a.length;f<d;f++){const p=new l(a[f]+"."+Le[i.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=as(t.constructor),s=new Float32Array(t.length);for(let i=0,o=t.length;i<o;i++)s[i]=t[i]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof rn?ka:xr;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function Xa(r,e,t){const n=e.attributes,s=new Gi;if(n.POSITION!==void 0){const c=t.json.accessors[n.POSITION],a=c.min,l=c.max;if(a!==void 0&&l!==void 0){if(s.set(new ie(a[0],a[1],a[2]),new ie(l[0],l[1],l[2])),c.normalized){const h=as(dt[c.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const c=new ie,a=new ie;for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],d=f.min,p=f.max;if(d!==void 0&&p!==void 0){if(a.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),a.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),a.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),f.normalized){const m=as(dt[f.componentType]);a.multiplyScalar(m)}c.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(c)}r.boundingBox=s;const o=new Hi;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,r.boundingSphere=o}function Zs(r,e,t){const n=e.attributes,s=[];function i(o,c){return t.getDependency("accessor",o).then(function(a){r.setAttribute(c,a)})}for(const o in n){const c=os[o]||o.toLowerCase();c in r.attributes||s.push(i(n[o],c))}if(e.indices!==void 0&&!r.index){const o=t.getDependency("accessor",e.indices).then(function(c){r.setIndex(c)});s.push(o)}return Re(r,e),Xa(r,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Ha(r,e.targets,t):r})}var jn=1/1e3,Wa=1e3,qa=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(r){typeof document<"u"&&document.hidden!==void 0&&(r?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=r)}get delta(){return this._delta*jn}get fixedDelta(){return this._fixedDelta*jn}set fixedDelta(r){this._fixedDelta=r*Wa}get elapsed(){return this._elapsed*jn}update(r){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(r!==void 0?r:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(r){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},$a=(()=>{const r=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new Cn;return t.setAttribute("position",new ke(r,3)),t.setAttribute("uv",new ke(e,2)),t})(),Ue=class cs{static get fullscreenGeometry(){return $a}constructor(e="Pass",t=new It,n=new Ut){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Gt(cs.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new It),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=In){}render(e,t,n,s,i){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof jt||t instanceof Be||t instanceof Je||t instanceof cs)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Ya=class extends Ue{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,s,i){const o=e.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},Qa=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,Za="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Ja=class extends Tt{constructor(){super({name:"CopyMaterial",defines:{COLOR_SPACE_CONVERSION:"1",DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new V(null),depthBuffer:new V(null),channelWeights:new V(null),opacity:new V(1)},blending:xs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qa,vertexShader:Za}),this.depthFunc=Fr}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(r){const e=r!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){const e=r!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=r}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}get colorSpaceConversion(){return this.defines.COLOR_SPACE_CONVERSION!==void 0}set colorSpaceConversion(r){this.colorSpaceConversion!==r&&(r?this.defines.COLOR_SPACE_CONVERSION=!0:delete this.defines.COLOR_SPACE_CONVERSION,this.needsUpdate=!0)}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(r){r!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=r):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(r){this.uniforms.inputBuffer.value=r}getOpacity(r){return this.uniforms.opacity.value}setOpacity(r){this.uniforms.opacity.value=r}},ec=class extends Ue{constructor(r,e=!0){super("CopyPass"),this.fullscreenMaterial=new Ja,this.needsSwap=!1,this.renderTarget=r,r===void 0&&(this.renderTarget=new jt(1,1,{minFilter:Q,magFilter:Q,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(r){this.autoResize=r}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(r){this.autoResize=r}render(r,e,t,n,s){this.fullscreenMaterial.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){this.autoResize&&this.renderTarget.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==on?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":r!==null&&r.outputColorSpace===$&&(this.renderTarget.texture.colorSpace=$))}},Js=new K,yr=class extends Ue{constructor(r=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=r,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(r,e,t){this.color=r,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(r){this.overrideClearColor=r}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(r){this.overrideClearAlpha=r}render(r,e,t,n,s){const i=this.overrideClearColor,o=this.overrideClearAlpha,c=r.getClearAlpha(),a=i!==null,l=o>=0;a?(r.getClearColor(Js),r.setClearColor(i,l?o:c)):l&&r.setClearAlpha(o),r.setRenderTarget(this.renderToScreen?null:e),r.clear(this.color,this.depth,this.stencil),a?r.setClearColor(Js,c):l&&r.setClearAlpha(c)}},tc=class extends Ue{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new yr(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,s,i){const o=e.getContext(),c=e.state.buffers,a=this.scene,l=this.camera,h=this.clearPass,u=this.inverted?0:1,f=1-u;c.color.setMask(!1),c.depth.setMask(!1),c.color.setLocked(!0),c.depth.setLocked(!0),c.stencil.setTest(!0),c.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),c.stencil.setFunc(o.ALWAYS,u,4294967295),c.stencil.setClear(f),c.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(n),e.render(a,l)),c.color.setLocked(!1),c.depth.setLocked(!1),c.stencil.setLocked(!1),c.stencil.setFunc(o.EQUAL,1,4294967295),c.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),c.stencil.setLocked(!0)}},nc=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:n=!1,multisampling:s=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,n,i,s),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new ec,this.depthTexture=null,this.passes=[],this.timer=new qa,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,n=this.multisampling;n>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new z),n=e.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;s===on&&e.outputColorSpace===$&&(this.inputBuffer.texture.colorSpace=$,this.outputBuffer.texture.colorSpace=$,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const i of this.passes)i.initialize(e,n,s)}}replaceRenderer(e,t=!0){const n=this.renderer,s=n.domElement.parentNode;return this.setRenderer(e),t&&s!==null&&(s.removeChild(n.domElement),s.appendChild(e.domElement)),n}createDepthTexture(){const e=this.depthTexture=new Pr;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Nr,e.type=Or):e.type=Dr,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,n,s){const i=this.renderer,o=i===null?new z:i.getDrawingBufferSize(new z),c={minFilter:Q,magFilter:Q,stencilBuffer:t,depthBuffer:e,type:n},a=new jt(o.width,o.height,c);return s>0&&(a.samples=s),n===on&&i!==null&&i.outputColorSpace===$&&(a.texture.colorSpace=$),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const n=this.passes,s=this.renderer,i=s.getDrawingBufferSize(new z),o=s.getContext().getContextAttributes().alpha,c=this.inputBuffer.texture.type;if(e.setRenderer(s),e.setSize(i.width,i.height),e.initialize(s,o,c),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(e of n)e.setDepthTexture(a)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,n=t.indexOf(e);if(n!==-1&&t.splice(n,1).length>0){if(this.depthTexture!==null){const o=(a,l)=>a||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,n=this.copyPass;let s=this.inputBuffer,i=this.outputBuffer,o=!1,c,a,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(t,s,i,e,o),h.needsSwap&&(o&&(n.renderToScreen=h.renderToScreen,c=t.getContext(),a=t.state.buffers.stencil,a.setFunc(c.NOTEQUAL,1,4294967295),n.render(t,s,i,e,o),a.setFunc(c.EQUAL,1,4294967295)),l=s,s=i,i=l),h instanceof tc?o=!0:h instanceof Ya&&(o=!1))}setSize(e,t,n){const s=this.renderer,i=s.getSize(new z);(e===void 0||t===void 0)&&(e=i.width,t=i.height),(i.width!==e||i.height!==t)&&s.setSize(e,t,n);const o=s.getDrawingBufferSize(new z);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const c of this.passes)c.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Ue.fullscreenGeometry.dispose()}},Qe={NONE:0,DEPTH:1,CONVOLUTION:2},N={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},sc=class{constructor(){this.shaderParts=new Map([[N.FRAGMENT_HEAD,null],[N.FRAGMENT_MAIN_UV,null],[N.FRAGMENT_MAIN_IMAGE,null],[N.VERTEX_HEAD,null],[N.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Qe.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=ce}},Vn=!1,ei=class{constructor(r=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(r),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case at:t=this.materialsFlatShadedDoubleSide;break;case Xt:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case at:t=this.materialsDoubleSide;break;case Xt:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(r){if(!(r instanceof Tt))return r.clone();const e=r.uniforms,t=new Map;for(const s in e){const i=e[s].value;i.isRenderTargetTexture&&(e[s].value=null,t.set(s,i))}const n=r.clone();for(const s of t)e[s[0]].value=s[1],n.uniforms[s[0]].value=s[1];return n}setMaterial(r){if(this.disposeMaterials(),this.material=r,r!==null){const e=this.materials=[this.cloneMaterial(r),this.cloneMaterial(r),this.cloneMaterial(r)];for(const t of e)t.uniforms=Object.assign({},r.uniforms),t.side=Ts;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=Xt,n}),this.materialsDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=at,n}),this.materialsFlatShaded=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=Xt,n}),this.materialsFlatShadedDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=at,n})}}render(r,e,t){const n=r.shadowMap.enabled;if(r.shadowMap.enabled=!1,Vn){const s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),r.render(e,t);for(const i of s)i[0].material=i[1];this.meshCount!==s.size&&s.clear()}else{const s=e.overrideMaterial;e.overrideMaterial=this.material,r.render(e,t),e.overrideMaterial=s}r.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const r=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of r)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Vn}static set workaroundEnabled(r){Vn=r}},I={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},ic="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",rc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,src.a*opacity);}",oc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=(dst.rgb+src.rgb)*0.5;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",ac="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.xy,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",cc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/max(b,1e-9))),vec3(1.0),step(1.0,a));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",lc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",uc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",hc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=abs(dst.rgb-src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",fc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb/max(src.rgb,1e-9);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",dc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-2.0*dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",pc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb,1.0);vec3 b=min(src.rgb,1.0);vec3 c=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",mc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=step(1.0,dst.rgb+src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",gc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.x,a.yz));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",vc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Tc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=src.rgb*max(1.0-dst.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",xc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",yc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Ec="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb+src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Ac="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(2.0*src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",wc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.xy,b.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Rc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Sc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-abs(1.0-dst.rgb-src.rgb),0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",_c="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,opacity);}",bc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=2.0*src.rgb*dst.rgb;vec3 b=1.0-2.0*(1.0-src.rgb)*(1.0-dst.rgb);vec3 c=mix(a,b,step(0.5,dst.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Mc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 c=mix(mix(src2,dst.rgb,step(0.5*dst.rgb,src.rgb)),max(src2-1.0,vec3(0.0)),step(dst.rgb,src2-1.0));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Cc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb*dst.rgb/max(1.0-src.rgb,1e-9),1.0);vec3 c=mix(a,src.rgb,step(1.0,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Lc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.x,b.y,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Ic="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-min(dst.rgb*src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Pc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 d=dst.rgb+(src2-1.0);vec3 w=step(0.5,src.rgb);vec3 a=dst.rgb-(1.0-src2)*dst.rgb*(1.0-dst.rgb);vec3 b=mix(d*(sqrt(dst.rgb)-dst.rgb),d*dst.rgb*((16.0*dst.rgb-12.0)*dst.rgb+3.0),w*(1.0-step(0.25,dst.rgb)));vec3 c=mix(a,b,w);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Nc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return src;}",Oc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Dc="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=mix(max(1.0-min((1.0-dst.rgb)/(2.0*src.rgb),1.0),0.0),min(dst.rgb/(2.0*(1.0-src.rgb)),1.0),step(0.5,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Fc=new Map([[I.ADD,ic],[I.ALPHA,rc],[I.AVERAGE,oc],[I.COLOR,ac],[I.COLOR_BURN,cc],[I.COLOR_DODGE,lc],[I.DARKEN,uc],[I.DIFFERENCE,hc],[I.DIVIDE,fc],[I.DST,null],[I.EXCLUSION,dc],[I.HARD_LIGHT,pc],[I.HARD_MIX,mc],[I.HUE,gc],[I.INVERT,vc],[I.INVERT_RGB,Tc],[I.LIGHTEN,xc],[I.LINEAR_BURN,yc],[I.LINEAR_DODGE,Ec],[I.LINEAR_LIGHT,Ac],[I.LUMINOSITY,wc],[I.MULTIPLY,Rc],[I.NEGATION,Sc],[I.NORMAL,_c],[I.OVERLAY,bc],[I.PIN_LIGHT,Mc],[I.REFLECT,Cc],[I.SATURATION,Lc],[I.SCREEN,Ic],[I.SOFT_LIGHT,Pc],[I.SRC,Nc],[I.SUBTRACT,Oc],[I.VIVID_LIGHT,Dc]]),kc=class extends Ui{constructor(r,e=1){super(),this._blendFunction=r,this.opacity=new V(e)}getOpacity(){return this.opacity.value}setOpacity(r){this.opacity.value=r}get blendFunction(){return this._blendFunction}set blendFunction(r){this._blendFunction=r,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(r){this.blendFunction=r}getShaderCode(){return Fc.get(this.blendFunction)}},Bc=class extends Ui{constructor(r,e,{attributes:t=Qe.NONE,blendFunction:n=I.NORMAL,defines:s=new Map,uniforms:i=new Map,extensions:o=null,vertexShader:c=null}={}){super(),this.name=r,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=c,this.defines=s,this.uniforms=i,this.extensions=o,this.blendMode=new kc(n),this.blendMode.addEventListener("change",a=>this.setChanged()),this._inputColorSpace=ce,this._outputColorSpace=ji}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(r){this._inputColorSpace=r,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(r){this._outputColorSpace=r,this.setChanged()}set mainScene(r){}set mainCamera(r){}getName(){return this.name}setRenderer(r){this.renderer=r}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(r){this.attributes=r,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(r){this.fragmentShader=r,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(r){this.vertexShader=r,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(r,e=In){}update(r,e,t){}setSize(r,e){}initialize(r,e,t){}dispose(){for(const r of Object.keys(this)){const e=this[r];(e instanceof jt||e instanceof Be||e instanceof Je||e instanceof Ue)&&this[r].dispose()}}},Gc=class extends Ue{constructor(e,t,n=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new yr,this.overrideMaterialManager=n===null?null:new ei(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new ei(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,s,i){const o=this.scene,c=this.camera,a=this.selection,l=c.layers.mask,h=o.background,u=e.shadowMap.autoUpdate,f=this.renderToScreen?null:t;a!==null&&c.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(f),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,o,c):e.render(o,c),c.layers.mask=l,o.background=h,e.shadowMap.autoUpdate=u}},Hc=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Uc="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",jc=class extends Tt{constructor(r,e,t,n,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:hi.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new V(null),depthBuffer:new V(null),resolution:new V(new z),texelSize:new V(new z),cameraNear:new V(.3),cameraFar:new V(1e3),aspect:new V(1),time:new V(0)},blending:xs,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),r&&this.setShaderParts(r),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(n)}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){this.uniforms.depthBuffer.value=r}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}setDepthBuffer(r,e=In){this.depthBuffer=r,this.depthPacking=e}setShaderData(r){this.setShaderParts(r.shaderParts),this.setDefines(r.defines),this.setUniforms(r.uniforms),this.setExtensions(r.extensions)}setShaderParts(r){return this.fragmentShader=Hc.replace(N.FRAGMENT_HEAD,r.get(N.FRAGMENT_HEAD)||"").replace(N.FRAGMENT_MAIN_UV,r.get(N.FRAGMENT_MAIN_UV)||"").replace(N.FRAGMENT_MAIN_IMAGE,r.get(N.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Uc.replace(N.VERTEX_HEAD,r.get(N.VERTEX_HEAD)||"").replace(N.VERTEX_MAIN_SUPPORT,r.get(N.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(r){for(const e of r.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(r){for(const e of r.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(r){this.extensions={};for(const e of r)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(r){this.encodeOutput!==r&&(r?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(r){return this.encodeOutput}setOutputEncodingEnabled(r){this.encodeOutput=r}get time(){return this.uniforms.time.value}set time(r){this.uniforms.time.value=r}setDeltaTime(r){this.uniforms.time.value+=r}adoptCameraSettings(r){this.copyCameraSettings(r)}copyCameraSettings(r){r&&(this.uniforms.cameraNear.value=r.near,this.uniforms.cameraFar.value=r.far,r instanceof Ht?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(r,e){const t=this.uniforms;t.resolution.value.set(r,e),t.texelSize.value.set(1/r,1/e),t.aspect.value=r/e}static get Section(){return N}};function ti(r,e,t){for(const n of e){const s="$1"+r+n.charAt(0).toUpperCase()+n.slice(1),i=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(i,s))}}function Vc(r,e,t){let n=e.getFragmentShader(),s=e.getVertexShader();const i=n!==void 0&&/mainImage/.test(n),o=n!==void 0&&/mainUv/.test(n);if(t.attributes|=e.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&(t.attributes&Qe.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!i&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const c=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,a=t.shaderParts;let l=a.get(N.FRAGMENT_HEAD)||"",h=a.get(N.FRAGMENT_MAIN_UV)||"",u=a.get(N.FRAGMENT_MAIN_IMAGE)||"",f=a.get(N.VERTEX_HEAD)||"",d=a.get(N.VERTEX_MAIN_SUPPORT)||"";const p=new Set,m=new Set;if(o&&(h+=`	${r}MainUv(UV);
`,t.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const T=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);d+=`	${r}MainSupport(`,d+=T?`vUv);
`:`);
`;for(const x of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const y of x[1].split(/\s*,\s*/))t.varyings.add(y),p.add(y),m.add(y);for(const x of s.matchAll(c))m.add(x[1])}for(const T of n.matchAll(c))m.add(T[1]);for(const T of e.defines.keys())m.add(T.replace(/\([\w\s,]*\)/g,""));for(const T of e.uniforms.keys())m.add(T);m.delete("while"),m.delete("for"),m.delete("if"),e.uniforms.forEach((T,x)=>t.uniforms.set(r+x.charAt(0).toUpperCase()+x.slice(1),T)),e.defines.forEach((T,x)=>t.defines.set(r+x.charAt(0).toUpperCase()+x.slice(1),T));const g=new Map([["fragment",n],["vertex",s]]);ti(r,m,t.defines),ti(r,m,g),n=g.get("fragment"),s=g.get("vertex");const v=e.blendMode;if(t.blendModes.set(v.blendFunction,v),i){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(u+=e.inputColorSpace===$?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==ji?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const T=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${r}MainImage(color0, UV, `,(t.attributes&Qe.DEPTH)!==0&&T.test(n)&&(u+="depth, ",t.readDepth=!0),u+=`color1);
	`;const x=r+"BlendOpacity";t.uniforms.set(x,v.opacity),u+=`color0 = blend${v.blendFunction}(color0, color1, ${x});

	`,l+=`uniform float ${x};

`}if(l+=n+`
`,s!==null&&(f+=s+`
`),a.set(N.FRAGMENT_HEAD,l),a.set(N.FRAGMENT_MAIN_UV,h),a.set(N.FRAGMENT_MAIN_IMAGE,u),a.set(N.VERTEX_HEAD,f),a.set(N.VERTEX_MAIN_SUPPORT,d),e.extensions!==null)for(const T of e.extensions)t.extensions.add(T)}}var zc=class extends Ue{constructor(r,...e){super("EffectPass"),this.fullscreenMaterial=new jc(null,null,null,r),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(r){for(const e of this.effects)e.mainScene=r}set mainCamera(r){this.fullscreenMaterial.copyCameraSettings(r);for(const e of this.effects)e.mainCamera=r}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(r){this.fullscreenMaterial.encodeOutput=r}get dithering(){return this.fullscreenMaterial.dithering}set dithering(r){const e=this.fullscreenMaterial;e.dithering=r,e.needsUpdate=!0}setEffects(r){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=r.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const r=new sc;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===I.DST)r.attributes|=o.getAttributes()&Qe.DEPTH;else{if((r.attributes&o.getAttributes()&Qe.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${o.name})`);Vc("e"+e++,o,r)}let t=r.shaderParts.get(N.FRAGMENT_HEAD),n=r.shaderParts.get(N.FRAGMENT_MAIN_IMAGE),s=r.shaderParts.get(N.FRAGMENT_MAIN_UV);const i=/\bblend\b/g;for(const o of r.blendModes.values())t+=o.getShaderCode().replace(i,`blend${o.blendFunction}`)+`
`;(r.attributes&Qe.DEPTH)!==0?(r.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,r.colorSpace===$&&(n+=`color0 = sRGBToLinear(color0);
	`),r.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,r.defines.set("UV","transformedUv")):r.defines.set("UV","vUv"),r.shaderParts.set(N.FRAGMENT_HEAD,t),r.shaderParts.set(N.FRAGMENT_MAIN_IMAGE,n),r.shaderParts.set(N.FRAGMENT_MAIN_UV,s);for(const[o,c]of r.shaderParts)c!==null&&r.shaderParts.set(o,c.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(r)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(r,e=In){this.fullscreenMaterial.depthBuffer=r,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(r,e)}render(r,e,t,n,s){for(const i of this.effects)i.update(r,e,n);if(!this.skipRendering||this.renderToScreen){const i=this.fullscreenMaterial;i.inputBuffer=e.texture,i.time+=n*this.timeScale,r.setRenderTarget(this.renderToScreen?null:t),r.render(this.scene,this.camera)}}setSize(r,e){this.fullscreenMaterial.setSize(r,e);for(const t of this.effects)t.setSize(r,e)}initialize(r,e,t){this.renderer=r;for(const n of this.effects)n.initialize(r,e,t);this.updateMaterial(),t!==void 0&&t!==on&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const r of this.effects)r.removeEventListener("change",this.listener),r.dispose()}handleEvent(r){r.type==="change"&&this.recompile()}};const Kc=`
uniform sampler2D uCharacters;
uniform float uCharactersCount;
uniform float uCellSize;
uniform bool uInvert;
uniform vec3 uColor;
uniform float uOpacity;

const vec2 SIZE = vec2(16.);

float random(vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
}

vec3 greyscale(vec3 color, float strength) {
    float g = dot(color, vec3(0.299, 0.587, 0.114));
    return mix(color, vec3(g), strength);
}

vec3 greyscale(vec3 color) {
    return greyscale(color, 1.0);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    vec2 cell = resolution / uCellSize;
    vec2 grid = 1.0 / cell;
    vec2 pixelizedUV = grid * (0.5 + floor(uv / grid));
    vec4 pixelized = texture2D(inputBuffer, pixelizedUV);
    float greyscaled = greyscale(pixelized.rgb).r;

    if (uInvert) {
        greyscaled = 1.0 - greyscaled;
    }

    float characterIndex = floor((uCharactersCount - 1.0) * greyscaled);
    vec2 characterPosition = vec2(mod(characterIndex, SIZE.x), floor(characterIndex / SIZE.y));
    vec2 offset = vec2(characterPosition.x, -characterPosition.y) / SIZE;
    vec2 charUV = mod(uv * (cell / SIZE), 1.0 / SIZE) - vec2(0., 1.0 / SIZE) + offset;
    vec4 asciiCharacter = texture2D(uCharacters, charUV);

    // Add grain to background
    float grain = random(uv * 2.0);
    vec3 grainColor = mix(pixelized.rgb, vec3(grain), 0.08);

    asciiCharacter.rgb = uColor * asciiCharacter.r * uOpacity;
    asciiCharacter.rgb = mix(asciiCharacter.rgb, vec3(grain), 0.05 * uOpacity);
    asciiCharacter.a = pixelized.a * asciiCharacter.a;
    outputColor = asciiCharacter;
}
`;class Xc extends Bc{constructor({characters:e=" .:,'-^=*+?!|0#%@",fontSize:t=10,cellSize:n=32,color:s="#ff1616ff",invert:i=!1,fontFamily:o="secondary"}={}){const c=new Map([["uCharacters",new V(new Je)],["uCellSize",new V(n)],["uCharactersCount",new V(e.length)],["uColor",new V(new K(s))],["uInvert",new V(i)],["uOpacity",new V(1)]]);super("ASCIIEffect",Kc,{uniforms:c});const a=this.uniforms.get("uCharacters");a&&(a.value=this.createCharactersTexture(e,t,o))}createCharactersTexture(e,t,n){const s=document.createElement("canvas"),i=1024,o=16,c=i/o;s.width=s.height=i;const a=new Vi(s,void 0,He,He,Lt,Lt),l=s.getContext("2d");if(!l)throw new Error("Context not available");const h=()=>{l.clearRect(0,0,i,i),l.font=`${t}px "${n}", monospace`,l.textAlign="center",l.textBaseline="middle",l.fillStyle="#ff0000ff";for(let u=0;u<e.length;u++){const f=e[u],d=u%o,p=Math.floor(u/o);l.fillText(f,d*c+c/2,p*c+c/2)}a.needsUpdate=!0};return document.fonts.load(`${t}px "${n}"`).then(()=>{h()}),h(),a}}const le=[{title:"Motion Study",image:"/canvas/image-1.jpg",year:2024},{title:"Idle Form",image:"/canvas/image-2.jpg",year:2023},{title:"Blur Signal",image:"/canvas/image-3.jpg",year:2024},{title:"Still Drift",image:"/canvas/image-4.jpg",year:2023},{title:"Tidewalk",image:"/canvas/image-5.jpg",year:2024},{title:"Core Motion",image:"/canvas/image-6.jpg",year:2022},{title:"White Bloom",image:"/canvas/image-7.jpg",year:2024},{title:"Backrun",image:"/canvas/image-8.jpg",year:2023},{title:"Rushline",image:"/canvas/image-9.jpg",year:2024},{title:"Afterimage",image:"/canvas/image-1.jpg",year:2023},{title:"Shadowhead",image:"/canvas/image-2.jpg",year:2022},{title:"Opal Lace",image:"/canvas/image-3.jpg",year:2024},{title:"Glassprint",image:"/canvas/image-4.jpg",year:2024},{title:"Redshift",image:"/canvas/image-5.jpg",year:2023},{title:"White Noise",image:"/canvas/image-6.jpg",year:2023},{title:"Twin Field",image:"/canvas/image-7.jpg",year:2024},{title:"Petalloop",image:"/canvas/image-8.jpg",year:2023},{title:"Ghostwalk",image:"/canvas/image-9.jpg",year:2024},{title:"Heatwave",image:"/canvas/image-1.jpg",year:2023},{title:"Sky Drift",image:"/canvas/image-2.jpg",year:2024},{title:"Spindle",image:"/canvas/image-3.jpg",year:2022},{title:"Pacer",image:"/canvas/image-4.jpg",year:2023},{title:"Stride",image:"/canvas/image-5.jpg",year:2024},{title:"Cryo Pulse",image:"/canvas/image-6.jpg",year:2022},{title:"Velvet Blur",image:"/canvas/image-7.jpg",year:2024}],Wc=`
  varying vec2 vUv;
  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,qc=`
  uniform vec2 uOffset;
  uniform vec2 uResolution;
  uniform vec4 uBorderColor;
  uniform vec4 uHoverColor;
  uniform vec4 uBackgroundColor;
  uniform vec2 uMousePos;
  uniform float uZoom;
  uniform float uCellSize;
  uniform float uTextureCount;
  uniform float uDistortion;
  uniform float uTime;
  uniform float uFocusState;
  uniform float uFocusIndex;
  uniform sampler2D uImageAtlas;
  varying vec2 vUv;

  float random(vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
  }

  // Improved noise for smoother variation
  float smoothNoise(vec2 st) {
    vec2 i = floor(st);
    vec2 f = fract(st);
    f = f * f * (3.0 - 2.0 * f); // Smoothstep
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));
    return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
  }

  // Playful offset variation based on cell position
  vec2 getPlayfulOffset(vec2 cellId) {
    float noiseX = smoothNoise(cellId * 0.5 + 123.456) * 0.3 - 0.15;
    float noiseY = smoothNoise(cellId * 0.5 + 789.012) * 0.3 - 0.15;
    return vec2(noiseX, noiseY);
  }
  
  void main() {
    vec2 screenUV = (vUv - 0.5) * 2.0;
    
    float radius = length(screenUV);
    float distortion = 1.0 - uDistortion * radius * radius;
    vec2 distortedUV = screenUV * distortion;
    
    vec2 aspectRatio = vec2(uResolution.x / uResolution.y, 1.0);
    vec2 worldCoord = distortedUV * aspectRatio;
    
    worldCoord *= uZoom;
    worldCoord += uOffset;
    
    vec2 cellPos = worldCoord / uCellSize;
    vec2 cellId = floor(cellPos);
    vec2 cellUV = fract(cellPos);

    // Get playful offset for this cell
    vec2 playfulOffset = getPlayfulOffset(cellId);

    // Apply offset to cell UV for natural, playful spacing
    cellUV -= playfulOffset;
    
    float texIndex = mod(cellId.x + cellId.y * 3.0, uTextureCount);
    if (texIndex < 0.0) texIndex += uTextureCount;
    texIndex = floor(texIndex);

    bool isFocused = abs(texIndex - uFocusIndex) < 0.1;

    vec2 mouseScreenUV = (uMousePos / uResolution) * 2.0 - 1.0;
    mouseScreenUV.y = -mouseScreenUV.y;
    
    float mouseRadius = length(mouseScreenUV);
    float mouseDistortion = 1.0 - uDistortion * mouseRadius * mouseRadius;
    vec2 mouseDistortedUV = mouseScreenUV * mouseDistortion;
    vec2 mouseWorldCoord = mouseDistortedUV * aspectRatio;
    
    mouseWorldCoord *= uZoom;
    mouseWorldCoord += uOffset;
    
    vec2 mouseCellPos = mouseWorldCoord / uCellSize;
    vec2 mouseCellId = floor(mouseCellPos);
    
    vec2 cellCenter = cellId + 0.5;
    vec2 mouseCellCenter = mouseCellId + 0.5;
    float cellDistance = length(cellCenter - mouseCellCenter);
    float hoverIntensity = 1.0 - smoothstep(0.4, 0.7, cellDistance);
    bool isHovered = hoverIntensity > 0.0 && uMousePos.x >= 0.0;
    
    vec3 color = vec3(0.0);
    float outAlpha = 0.0;
    
    float baseImageSize = 0.6;
    float targetImageSize = isFocused ? 0.96 : 0.6 * 0.7;
    float imageSize = mix(baseImageSize, targetImageSize, uFocusState);
    
    float imageBorder = (1.0 - imageSize) * 0.5;
    
    vec2 imageUV = (cellUV - imageBorder) / imageSize;

    float edgeSmooth = 0.01;
    vec2 imageMask = smoothstep(-edgeSmooth, edgeSmooth, imageUV) * 
                    smoothstep(-edgeSmooth, edgeSmooth, 1.0 - imageUV);
    float imageAlpha = imageMask.x * imageMask.y;
    
    bool inImageArea = imageUV.x >= 0.0 && imageUV.x <= 1.0 && imageUV.y >= 0.0 && imageUV.y <= 1.0;
    
    if (inImageArea && imageAlpha > 0.0) {
      float atlasSize = ceil(sqrt(uTextureCount));
      vec2 atlasPos = vec2(mod(texIndex, atlasSize), floor(texIndex / atlasSize));
      
      // Chromatic Aberration
      float caStrength = 0.02 * radius; 
      vec2 caOffset = screenUV * caStrength; 

      // R
      vec2 imageUVR = imageUV - caOffset;
      vec2 atlasUVR = (atlasPos + imageUVR) / atlasSize;
      atlasUVR.y = 1.0 - atlasUVR.y;
      
      // G
      vec2 imageUVG = imageUV;
      vec2 atlasUVG = (atlasPos + imageUVG) / atlasSize;
      atlasUVG.y = 1.0 - atlasUVG.y;
      
      // B
      vec2 imageUVB = imageUV + caOffset;
      vec2 atlasUVB = (atlasPos + imageUVB) / atlasSize;
      atlasUVB.y = 1.0 - atlasUVB.y;

      float r = texture2D(uImageAtlas, atlasUVR).r;
      float g = texture2D(uImageAtlas, atlasUVG).g;
      float b = texture2D(uImageAtlas, atlasUVB).b;
      float a = texture2D(uImageAtlas, atlasUVG).a;

      vec3 finalImageColor = vec3(r, g, b);
      
      // Darken non-focused images
      if (!isFocused) {
          finalImageColor *= mix(1.0, 0.1, uFocusState);
      }

      color = finalImageColor;
      outAlpha = imageAlpha * a;
    }
    
    float fade = 1.0 - smoothstep(1.2, 1.8, radius);

    outAlpha *= fade;
    gl_FragColor = vec4(color * fade, outAlpha);
  }
`,X={cellSize:.75,zoomLevel:1.25,lerpFactor:.05,borderColor:"rgba(255, 255, 255, 0.15)",hoverColor:"rgba(255, 255, 255, 0)"};let k,Me,Ft=!1,en=null,ls=[],mn=[],ot,se,us,tt,Yt={x:0,y:0},gn={angle:Math.PI/2,y:0},Ve={angle:Math.PI/2,y:0};const $c=Math.sqrt(50)/2.5;let kt,Bt,G,Nn=!1,On=!0,Er=0,me={x:0,y:0},Ne={x:0,y:0},ge={x:0,y:0},st={x:0,y:0},vn={x:0,y:0},it={x:-1,y:-1},bt=1,ye=1,zn=.08,bs=.08,Z=-1,Tn={value:0},xn={value:1},Ze={x:0,y:0};const ni=r=>{const e=r.match(/rgba?\(([^)]+)\)/);return e?e[1].split(",").map((t,n)=>n<3?parseFloat(t.trim())/255:parseFloat(t.trim()||1)):[1,1,1,1]},Yc=r=>{const e=Math.ceil(Math.sqrt(r.length)),t=512,n=document.createElement("canvas");n.width=n.height=e*t;const s=n.getContext("2d");s.clearRect(0,0,n.width,n.height),r.forEach((o,c)=>{const a=c%e*t,l=Math.floor(c/e)*t;if(o.image?.complete){const h=o.image,u=h.width/h.height;let f=t,d=t,p=a,m=l;u>1?(d=t/u,m=l+(t-d)/2):(f=t*u,p=a+(t-f)/2),s.drawImage(h,p,m,f,d)}});const i=new Vi(n);return Object.assign(i,{wrapS:vt,wrapT:vt,minFilter:Q,magFilter:Q,flipY:!1}),i},Qc=()=>{const r=new vs,e=[];let t=0;return new Promise(n=>{le.forEach(s=>{const i=r.load(s.image,()=>{++t===le.length&&n(e)});Object.assign(i,{wrapS:vt,wrapT:vt,minFilter:Q,magFilter:Q}),e.push(i),mn.push(i)})})},Zc=(r,e,t)=>{let n={x:0,y:0},s=1/0;const i=20,o=Math.round(e),c=Math.round(t);for(let a=o-i;a<=o+i;a++)for(let l=c-i;l<=c+i;l++){let h=(a+l*3)%le.length;if(h<0&&(h+=le.length),h===r){const u=(a-e)**2+(l-t)**2;u<s&&(s=u,n={x:a,y:l})}}return s===1/0?(console.warn("Could not find nearest cell for index",r),{x:o,y:c}):n},hs=r=>r.split("").map(e=>`<span style="display:inline-block; will-change: transform;">${e===" "?"&nbsp;":e}</span>`).join(""),Jc=(r,e)=>{r.querySelector("span")||(r.innerHTML=hs(r.textContent));const t=r.querySelectorAll("span");F.to(t,{y:"100%",opacity:0,stagger:.02,duration:.4,ease:"power2.in",onComplete:()=>{r.innerHTML=hs(e);const n=r.querySelectorAll("span");F.fromTo(n,{y:"100%",opacity:0},{y:"0%",opacity:1,stagger:.02,duration:.4,ease:"power2.out"})}})},Ar=r=>{const e=document.getElementById("archive-overlay"),t=document.getElementById("archive-title"),n=document.getElementById("archive-year");if(r!==-1){const s=le[r].title,i=le[r].year;t&&(e.style.opacity==="1"&&t.textContent.replace(/\u00a0/g," ")!==s?Jc(t,s):(t.innerHTML=hs(s),F.set(t.querySelectorAll("span"),{y:"0%",opacity:1}))),n&&(n.textContent=i),e&&(e.style.opacity="1",e.style.pointerEvents="auto")}else e&&(e.style.opacity="0",e.style.pointerEvents="none")},fs=(r,e,t)=>{if(Z===r&&Ze.x===e&&Ze.y===t)return;Z=r,Ze={x:e,y:t},G?.material?.uniforms&&(G.material.uniforms.uFocusIndex.value=r),F.to(Tn,{value:1,duration:.8,ease:"power3.out",onUpdate:()=>{G?.material?.uniforms&&(G.material.uniforms.uFocusState.value=Tn.value)}}),F.to(xn,{value:.05,duration:.8,ease:"power3.out",onUpdate:()=>{tt?.uniforms.get("uOpacity")&&(tt.uniforms.get("uOpacity").value=xn.value)}});const n=(e+.5)*X.cellSize,s=(t+.5)*X.cellSize;ge.x=n,ge.y=s,Ar(r)},pt=()=>{Z!==-1&&(Z=-1,F.to(Tn,{value:0,duration:.6,ease:"power3.out",onUpdate:()=>{G?.material?.uniforms&&(G.material.uniforms.uFocusState.value=Tn.value)}}),F.to(xn,{value:1,duration:.6,ease:"power3.out",onUpdate:()=>{tt?.uniforms.get("uOpacity")&&(tt.uniforms.get("uOpacity").value=xn.value)}}),Ar(-1))},yn=r=>{if(Z===-1)return;let e=Z+r;e>=le.length&&(e=0),e<0&&(e=le.length-1);const t=Ze.x,n=Ze.y,s=Zc(e,t,n);fs(e,s.x,s.y)},el=()=>{const r=document.getElementById("gallery");if(!r||!k)return;const e=Math.max(1,r.offsetWidth||window.innerWidth||1),t=Math.max(1,r.offsetHeight||window.innerHeight||1);se&&(se.aspect=e/t,se.updateProjectionMatrix()),k.setSize(e,t),k.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),Me&&Me.setSize(e,t),G?.material?.uniforms&&G.material.uniforms.uResolution.value.set(e,t)},tl=r=>{if(Yt.x=r.clientX/window.innerWidth*2-1,Yt.y=-(r.clientY/window.innerHeight)*2+1,gn.angle=Math.PI/2-Yt.x*.1,gn.y=Yt.y*.4,!k)return;const e=k.domElement.getBoundingClientRect();it.x=r.clientX-e.left,it.y=r.clientY-e.top,G?.material?.uniforms&&G.material.uniforms.uMousePos.value.set(it.x,it.y);const t=it.x/e.width*2-1,n=-(it.y/e.height)*2+1,s=Z!==-1?0:.05;if(vn.x=t*s,vn.y=n*s,Nn){const i=r.clientX-me.x,o=r.clientY-me.y;(Math.abs(i)>2||Math.abs(o)>2)&&(On=!1,ye===1&&(ye=X.zoomLevel),Z!==-1&&pt()),ge.x-=i*.003,ge.y+=o*.003,me.x=r.clientX,me.y=r.clientY}},wr=(r,e)=>{Nn=!0,On=!0,Er=Date.now(),document.body.classList.add("dragging"),me.x=r,me.y=e,bs=0},nl=r=>{r.target.closest(".nav-btn")||r.target.closest("#archive-close")||(wr(r.clientX,r.clientY),ye===1&&(ye=X.zoomLevel))},sl=r=>{r.target.closest(".nav-btn")||r.target.closest("#archive-close")||(r.preventDefault(),wr(r.touches[0].clientX,r.touches[0].clientY),ye===1&&(ye=X.zoomLevel))},Kn=r=>{if(Nn=!1,document.body.classList.remove("dragging"),ye=1,bs=.08,On&&Date.now()-Er<200){const e=r.clientX||r.changedTouches?.[0]?.clientX,t=r.clientY||r.changedTouches?.[0]?.clientY;if(e!==void 0&&t!==void 0&&k){const n=k.domElement.getBoundingClientRect(),s=(e-n.left)/n.width*2-1,i=-((t-n.top)/n.height*2-1),o=Math.sqrt(s*s+i*i),c=1-.08*o*o;let a=s*c*(n.width/n.height)*bt+Ne.x,l=i*c*bt+Ne.y;const h=Math.floor(a/X.cellSize),u=Math.floor(l/X.cellSize),f=a/X.cellSize-h,d=l/X.cellSize-u,p=f>.15&&f<.85&&d>.15&&d<.85,m=Math.floor((h+u*3)%le.length),g=m<0?le.length+m:m;Z===-1?p&&fs(g,h,u):p?(g!==Z||h!==Ze.x||u!==Ze.y)&&fs(g,h,u):pt()}}},il=r=>{Z!==-1&&(r.key==="ArrowRight"&&yn(1),r.key==="ArrowLeft"&&yn(-1),r.key==="Escape"&&pt())},q=(r,e,t,n)=>{r.addEventListener(e,t,n),ls.push({target:r,type:e,handler:t,opts:n})},rl=()=>{q(document,"mousedown",nl),q(document,"mousemove",tl),q(document,"mouseup",Kn),q(document,"mouseleave",Kn);const r={passive:!1};q(document,"touchstart",sl,r),q(document,"touchmove",s=>{if(s.preventDefault(),Nn){const i=s.touches[0],o=i.clientX-me.x,c=i.clientY-me.y;(Math.abs(o)>2||Math.abs(c)>2)&&(On=!1,ye===1&&(ye=X.zoomLevel),Z!==-1&&pt()),ge.x-=o*.003,ge.y+=c*.003,me.x=i.clientX,me.y=i.clientY}},r),q(document,"touchend",Kn,r),q(window,"resize",el),q(document,"contextmenu",s=>s.preventDefault()),q(window,"keydown",il),q(window,"wheel",s=>{s.preventDefault();const i=.002;ge.x+=s.deltaX*i,ge.y-=s.deltaY*i,Z!==-1&&(Math.abs(s.deltaX)>5||Math.abs(s.deltaY)>5)&&pt()},{passive:!1});const e=document.getElementById("archive-close"),t=document.getElementById("archive-prev"),n=document.getElementById("archive-next");e&&q(e,"click",s=>{s.stopPropagation(),pt()}),t&&q(t,"click",s=>{s.stopPropagation(),yn(-1)}),n&&q(n,"click",s=>{s.stopPropagation(),yn(1)})},Rr=()=>{if(!Ft)return;en=requestAnimationFrame(Rr),Ve.angle+=(gn.angle-Ve.angle)*.025,Ve.y+=(gn.y-Ve.y)*.025;const r=window.scrollY,t=Math.max(.5,$c-r*.001);se&&(se.position.x=Math.cos(Ve.angle)*t,se.position.z=Math.sin(Ve.angle)*t,se.position.y=Ve.y+1,se.lookAt(0,0,0)),Ne.x+=(ge.x-Ne.x)*X.lerpFactor,Ne.y+=(ge.y-Ne.y)*X.lerpFactor,st.x+=(vn.x-st.x)*.05,st.y+=(vn.y-st.y)*.05,bt+=(ye-bt)*.15,zn+=(bs-zn)*X.lerpFactor,G?.material?.uniforms&&(G.material.uniforms.uOffset.value.set(Ne.x+st.x,Ne.y+st.y),G.material.uniforms.uZoom.value=bt,G.material.uniforms.uDistortion.value=zn,G.material.uniforms.uTime.value=performance.now()*.001),Me&&Me.render(),k&&kt&&Bt&&(k.autoClear=!1,k.clearDepth(),k.render(kt,Bt),k.autoClear=!0)},ol=async()=>{const r=document.getElementById("gallery");if(!r)return;const e=Math.max(1,r.offsetWidth||window.innerWidth||1),t=Math.max(1,r.offsetHeight||window.innerHeight||1);k=new zi({antialias:!0,alpha:!0}),k.setSize(e,t),k.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),k.toneMapping=ys,k.toneMappingExposure=1,k.setClearColor(0,0),r.appendChild(k.domElement),ot=new It,se=new Ht(100,e/t,.1,1e3);const n=new Ki(16777215,.5);ot.add(n);const s=new Rn(16777215,1);s.position.set(5,5,5),ot.add(s),new fa().load("/home/scene.glb",d=>{us=d.scene,ot.add(us)},void 0,d=>console.error("Failed to load scene.glb",d)),Me=new nc(k);const o=new Gc(ot,se);Me.addPass(o),tt=new Xc({fontSize:54,cellSize:16,color:"#ffffff",fontFamily:"secondary"});const c=new zc(se,tt);Me.addPass(c),kt=new It,Bt=new Ut(-1,1,1,-1,.1,10),Bt.position.z=1;const a=await Qc(),l=Yc(a);mn.push(l);const h={uOffset:{value:new z(0,0)},uResolution:{value:new z(e,t)},uBorderColor:{value:new Ls(...ni(X.borderColor))},uHoverColor:{value:new Ls(...ni(X.hoverColor))},uMousePos:{value:new z(-1,-1)},uZoom:{value:1},uDistortion:{value:.08},uTime:{value:0},uCellSize:{value:X.cellSize},uTextureCount:{value:le.length},uImageAtlas:{value:l},uFocusIndex:{value:-1},uFocusState:{value:0}},u=new kr(2,2),f=new Tt({vertexShader:Wc,fragmentShader:qc,uniforms:h,transparent:!0});G=new Gt(u,f),kt.add(G),rl(),Ft=!0,Rr()};async function al(){Ft||await ol()}function ds(){Ft&&(Ft=!1,en&&(cancelAnimationFrame(en),en=null),ls.forEach(({target:r,type:e,handler:t,opts:n})=>r.removeEventListener(e,t,n)),ls=[],k&&(k.dispose(),k.domElement?.parentNode&&k.domElement.parentNode.removeChild(k.domElement)),Me&&Me.dispose(),G?.material&&G.material.dispose(),G?.geometry&&G.geometry.dispose(),mn.forEach(r=>r?.dispose?.()),mn=[],ot=null,se=null,kt=null,Bt=null,us=null,G=null,tt=null)}function si(r,e){if(e===fi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===gt||e===An){let t=r.getIndex();if(t===null){const o=[],c=r.getAttribute("position");if(c!==void 0){for(let a=0;a<c.count;a++)o.push(a);r.setIndex(o),t=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const n=t.count-2,s=[];if(e===gt)for(let o=1;o<=n;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=r.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}class cl extends di{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new dl(t)}),this.register(function(t){return new pl(t)}),this.register(function(t){return new wl(t)}),this.register(function(t){return new Rl(t)}),this.register(function(t){return new Sl(t)}),this.register(function(t){return new gl(t)}),this.register(function(t){return new vl(t)}),this.register(function(t){return new Tl(t)}),this.register(function(t){return new xl(t)}),this.register(function(t){return new fl(t)}),this.register(function(t){return new yl(t)}),this.register(function(t){return new ml(t)}),this.register(function(t){return new Al(t)}),this.register(function(t){return new El(t)}),this.register(function(t){return new ul(t)}),this.register(function(t){return new _l(t)}),this.register(function(t){return new bl(t)})}load(e,t,n,s){const i=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=ve.extractUrlBase(e);o=ve.resolveURL(l,this.path)}else o=ve.extractUrlBase(e);this.manager.itemStart(e);const c=function(l){s?s(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},a=new wn(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i.parse(l,o,function(h){t(h),i.manager.itemEnd(e)},c)}catch(h){c(h)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let i;const o={},c={},a=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===Sr){try{o[C.KHR_BINARY_GLTF]=new Ml(e)}catch(u){s&&s(u);return}i=JSON.parse(o[C.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Ul(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[u.name]=u,o[u.name]=!0}if(i.extensionsUsed)for(let h=0;h<i.extensionsUsed.length;++h){const u=i.extensionsUsed[h],f=i.extensionsRequired||[];switch(u){case C.KHR_MATERIALS_UNLIT:o[u]=new hl;break;case C.KHR_DRACO_MESH_COMPRESSION:o[u]=new Cl(i,this.dracoLoader);break;case C.KHR_TEXTURE_TRANSFORM:o[u]=new Ll;break;case C.KHR_MESH_QUANTIZATION:o[u]=new Il;break;default:f.indexOf(u)>=0&&c[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(c),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,i){n.parse(e,t,s,i)})}}function ll(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const C={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ul{constructor(e){this.parser=e,this.name=C.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const h=new K(16777215);a.color!==void 0&&h.setRGB(a.color[0],a.color[1],a.color[2],ce);const u=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Rn(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new mi(h),l.distance=u;break;case"spot":l=new pi(h),l.distance=u,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),he(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],c=(i.extensions&&i.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(a){return n._getNodeRef(t.cache,c,a)})}}class hl{constructor(){this.name=C.KHR_MATERIALS_UNLIT}getMaterialType(){return de}extendParams(e,t,n){const s=[];e.color=new K(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],ce),e.opacity=o[3]}i.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",i.baseColorTexture,$))}return Promise.all(s)}}class fl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class dl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new z(c,c)}return Promise.all(i)}}class pl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class ml{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class gl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new K(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const c=o.sheenColorFactor;t.sheenColor.setRGB(c[0],c[1],c[2],ce)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,$)),o.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class vl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class Tl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const c=o.attenuationColor||[1,1,1];return t.attenuationColor=new K().setRGB(c[0],c[1],c[2],ce),Promise.all(i)}}class xl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class yl{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return t.specularColor=new K().setRGB(c[0],c[1],c[2],ce),o.specularColorTexture!==void 0&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,$)),Promise.all(i)}}class El{constructor(e){this.parser=e,this.name=C.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&i.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(i)}}class Al{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:U}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class wl{constructor(e){this.parser=e,this.name=C.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class Rl{constructor(e){this.parser=e,this.name=C.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],c=s.images[o.source];let a=n.textureLoader;if(c.uri){const l=n.options.manager.getHandler(c.uri);l!==null&&(a=l)}return n.loadTextureImage(e,o.source,a)}}class Sl{constructor(e){this.parser=e,this.name=C.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],c=s.images[o.source];let a=n.textureLoader;if(c.uri){const l=n.options.manager.getHandler(c.uri);l!==null&&(a=l)}return n.loadTextureImage(e,o.source,a)}}class _l{constructor(e){this.name=C.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(c){const a=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,f=new Uint8Array(c,a,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,f,s.mode,s.filter).then(function(d){return d.buffer}):o.ready.then(function(){const d=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(d),h,u,f,s.mode,s.filter),d})})}else return null}}class bl{constructor(e){this.name=C.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const l of s.primitives)if(l.mode!==te.TRIANGLES&&l.mode!==te.TRIANGLE_STRIP&&l.mode!==te.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=n.extensions[this.name].attributes,c=[],a={};for(const l in o)c.push(this.parser.getDependency("accessor",o[l]).then(h=>(a[l]=h,a[l])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(l=>{const h=l.pop(),u=h.isGroup?h.children:[h],f=l[0].count,d=[];for(const p of u){const m=new Ge,g=new ie,v=new Sn,T=new ie(1,1,1),x=new gi(p.geometry,p.material,f);for(let y=0;y<f;y++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,y),a.ROTATION&&v.fromBufferAttribute(a.ROTATION,y),a.SCALE&&T.fromBufferAttribute(a.SCALE,y),x.setMatrixAt(y,m.compose(g,v,T));for(const y in a)if(y==="_COLOR_0"){const A=a[y];x.instanceColor=new vi(A.array,A.itemSize,A.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,a[y]);_n.prototype.copy.call(x,p),this.parser.assignFinalMaterial(x),d.push(x)}return h.isGroup?(h.clear(),h.add(...d),h):d[0]}))}}const Sr="glTF",Rt=12,ii={JSON:1313821514,BIN:5130562};class Ml{constructor(e){this.name=C.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Rt),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Sr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Rt,i=new DataView(e,Rt);let o=0;for(;o<s;){const c=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,a===ii.JSON){const l=new Uint8Array(e,Rt+o,c);this.content=n.decode(l)}else if(a===ii.BIN){const l=Rt+o;this.body=e.slice(l,l+c)}o+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Cl{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=C.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},a={},l={};for(const h in o){const u=ps[h]||h.toLowerCase();c[u]=o[h]}for(const h in e.attributes){const u=ps[h]||h.toLowerCase();if(o[h]!==void 0){const f=n.accessors[e.attributes[h]],d=mt[f.componentType];l[u]=d.name,a[u]=f.normalized===!0}}return t.getDependency("bufferView",i).then(function(h){return new Promise(function(u,f){s.decodeDracoFile(h,function(d){for(const p in d.attributes){const m=d.attributes[p],g=a[p];g!==void 0&&(m.normalized=g)}u(d)},c,l,ce,f)})})}}class Ll{constructor(){this.name=C.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Il{constructor(){this.name=C.KHR_MESH_QUANTIZATION}}class _r extends Bi{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,i=e*s*3+s;for(let o=0;o!==s;o++)t[o]=n[i+o];return t}interpolate_(e,t,n,s){const i=this.resultBuffer,o=this.sampleValues,c=this.valueSize,a=c*2,l=c*3,h=s-t,u=(n-t)/h,f=u*u,d=f*u,p=e*l,m=p-l,g=-2*d+3*f,v=d-f,T=1-g,x=v-f+u;for(let y=0;y!==c;y++){const A=o[m+y+c],w=o[m+y+a]*h,E=o[p+y+c],_=o[p+y]*h;i[y]=T*A+x*w+g*E+v*_}return i}}const Pl=new Sn;class Nl extends _r{interpolate_(e,t,n,s){const i=super.interpolate_(e,t,n,s);return Pl.fromArray(i).normalize().toArray(i),i}}const te={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},mt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ri={9728:Lt,9729:Q,9984:Ai,9985:Ei,9986:yi,9987:bn},oi={33071:vt,33648:wi,10497:He},Xn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ps={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ie={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ol={CUBICSPLINE:void 0,LINEAR:Ln,STEP:Fi},Wn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Dl(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new Mn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ts})),r.DefaultMaterial}function ze(r,e,t){for(const n in t.extensions)r[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function he(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Fl(r,e,t){let n=!1,s=!1,i=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(i=!0),n&&s&&i)break}if(!n&&!s&&!i)return Promise.resolve(r);const o=[],c=[],a=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):r.attributes.position;o.push(f)}if(s){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):r.attributes.normal;c.push(f)}if(i){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):r.attributes.color;a.push(f)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(a)]).then(function(l){const h=l[0],u=l[1],f=l[2];return n&&(r.morphAttributes.position=h),s&&(r.morphAttributes.normal=u),i&&(r.morphAttributes.color=f),r.morphTargetsRelative=!0,r})}function kl(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)r.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(r.morphTargetInfluences.length===t.length){r.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)r.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Bl(r){let e;const t=r.extensions&&r.extensions[C.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+qn(t.attributes):e=r.indices+":"+qn(r.attributes)+":"+r.mode,r.targets!==void 0)for(let n=0,s=r.targets.length;n<s;n++)e+=":"+qn(r.targets[n]);return e}function qn(r){let e="";const t=Object.keys(r).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+r[t[n]]+";";return e}function ms(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Gl(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":r.search(/\.ktx2($|\?)/i)>0||r.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Hl=new Ge;class Ul{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ll,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=-1,i=!1,o=-1;if(typeof navigator<"u"){const c=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(c)===!0;const a=c.match(/Version\/(\d+)/);s=n&&a?parseInt(a[1],10):-1,i=c.indexOf("Firefox")>-1,o=i?c.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&s<17||i&&o<98?this.textureLoader=new vs(this.options.manager):this.textureLoader=new Ti(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new wn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const c={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:n,userData:{}};return ze(i,c,s),he(c,s),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(c)})).then(function(){for(const a of c.scenes)a.updateMatrixWorld();e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,i=t.length;s<i;s++){const o=t[s].joints;for(let c=0,a=o.length;c<a;c++)e[o[c]].isBone=!0}for(let s=0,i=e.length;s<i;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),i=(o,c)=>{const a=this.associations.get(o);a!=null&&this.associations.set(c,a);for(const[l,h]of o.children.entries())i(h,c.children[l])};return i(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const i=e(t[s]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(i,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[C.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,o){n.load(ve.resolveURL(t.uri,s.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,i=t.byteOffset||0;return n.slice(i,i+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Xn[s.type],c=mt[s.componentType],a=s.normalized===!0,l=new c(s.count*o);return Promise.resolve(new ke(l,o,a))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(o){const c=o[0],a=Xn[s.type],l=mt[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*a,f=s.byteOffset||0,d=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let m,g;if(d&&d!==u){const v=Math.floor(f/d),T="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let x=t.cache.get(T);x||(m=new l(c,v*d,s.count*d/h),x=new xi(m,d/h),t.cache.add(T,x)),g=new ki(x,a,f%d/h,p)}else c===null?m=new l(s.count*a):m=new l(c,f,s.count*a),g=new ke(m,a,p);if(s.sparse!==void 0){const v=Xn.SCALAR,T=mt[s.sparse.indices.componentType],x=s.sparse.indices.byteOffset||0,y=s.sparse.values.byteOffset||0,A=new T(o[1],x,s.sparse.count*v),w=new l(o[2],y,s.sparse.count*a);c!==null&&(g=new ke(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let E=0,_=A.length;E<_;E++){const R=A[E];if(g.setX(R,w[E*a]),a>=2&&g.setY(R,w[E*a+1]),a>=3&&g.setZ(R,w[E*a+2]),a>=4&&g.setW(R,w[E*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=p}return g})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let c=this.textureLoader;if(o.uri){const a=n.manager.getHandler(o.uri);a!==null&&(c=a)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,t,n){const s=this,i=this.json,o=i.textures[e],c=i.images[t],a=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=o.name||c.name||"",h.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(h.name=c.uri);const f=(i.samplers||{})[o.sampler]||{};return h.magFilter=ri[f.magFilter]||Q,h.minFilter=ri[f.minFilter]||bn,h.wrapS=oi[f.wrapS]||He,h.wrapT=oi[f.wrapT]||He,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==Lt&&h.minFilter!==Q,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,s=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=s.images[e],c=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(o.bufferView!==void 0)a=n.getDependency("bufferView",o.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:o.mimeType});return a=c.createObjectURL(f),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then(function(u){return new Promise(function(f,d){let p=f;t.isImageBitmapLoader===!0&&(p=function(m){const g=new Je(m);g.needsUpdate=!0,f(g)}),t.load(ve.resolveURL(u,i.path),p,void 0,d)})}).then(function(u){return l===!0&&c.revokeObjectURL(a),he(u,o),u.userData.mimeType=o.mimeType||Gl(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,s){const i=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),i.extensions[C.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[C.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const a=i.associations.get(o);o=i.extensions[C.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),i.associations.set(o,a)}}return s!==void 0&&(o.colorSpace=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let a=this.cache.get(c);a||(a=new Ri,Be.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(c,a)),n=a}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let a=this.cache.get(c);a||(a=new Si,Be.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,this.cache.add(c,a)),n=a}if(s||i||o){let c="ClonedMaterial:"+n.uuid+":";s&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let a=this.cache.get(c);a||(a=n.clone(),i&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(c,a),this.associations.set(a,this.associations.get(n))),n=a}e.material=n}getMaterialType(){return Mn}loadMaterial(e){const t=this,n=this.json,s=this.extensions,i=n.materials[e];let o;const c={},a=i.extensions||{},l=[];if(a[C.KHR_MATERIALS_UNLIT]){const u=s[C.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),l.push(u.extendParams(c,i,t))}else{const u=i.pbrMetallicRoughness||{};if(c.color=new K(1,1,1),c.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;c.color.setRGB(f[0],f[1],f[2],ce),c.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(c,"map",u.baseColorTexture,$)),c.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,c.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(c,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(c,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,c)})))}i.doubleSided===!0&&(c.side=at);const h=i.alphaMode||Wn.OPAQUE;if(h===Wn.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,h===Wn.MASK&&(c.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==de&&(l.push(t.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new z(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;c.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&o!==de&&(l.push(t.assignTexture(c,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==de){const u=i.emissiveFactor;c.emissive=new K().setRGB(u[0],u[1],u[2],ce)}return i.emissiveTexture!==void 0&&o!==de&&l.push(t.assignTexture(c,"emissiveMap",i.emissiveTexture,$)),Promise.all(l).then(function(){const u=new o(c);return i.name&&(u.name=i.name),he(u,i),t.associations.set(u,{materials:e}),i.extensions&&ze(s,u,i),u})}createUniqueName(e){const t=_i.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function i(c){return n[C.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(a){return ai(a,c,t)})}const o=[];for(let c=0,a=e.length;c<a;c++){const l=e[c],h=Bl(l),u=s[h];if(u)o.push(u.promise);else{let f;l.extensions&&l.extensions[C.KHR_DRACO_MESH_COMPRESSION]?f=i(l):f=ai(new Cn,l,t),s[h]={primitive:l,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,s=this.extensions,i=n.meshes[e],o=i.primitives,c=[];for(let a=0,l=o.length;a<l;a++){const h=o[a].material===void 0?Dl(this.cache):this.getDependency("material",o[a].material);c.push(h)}return c.push(t.loadGeometries(o)),Promise.all(c).then(function(a){const l=a.slice(0,a.length-1),h=a[a.length-1],u=[];for(let d=0,p=h.length;d<p;d++){const m=h[d],g=o[d];let v;const T=l[d];if(g.mode===te.TRIANGLES||g.mode===te.TRIANGLE_STRIP||g.mode===te.TRIANGLE_FAN||g.mode===void 0)v=i.isSkinnedMesh===!0?new bi(m,T):new Gt(m,T),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),g.mode===te.TRIANGLE_STRIP?v.geometry=si(v.geometry,An):g.mode===te.TRIANGLE_FAN&&(v.geometry=si(v.geometry,gt));else if(g.mode===te.LINES)v=new Mi(m,T);else if(g.mode===te.LINE_STRIP)v=new Ci(m,T);else if(g.mode===te.LINE_LOOP)v=new Li(m,T);else if(g.mode===te.POINTS)v=new Ii(m,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(v.geometry.morphAttributes).length>0&&kl(v,i),v.name=t.createUniqueName(i.name||"mesh_"+e),he(v,i),g.extensions&&ze(s,v,g),t.assignFinalMaterial(v),u.push(v)}for(let d=0,p=u.length;d<p;d++)t.associations.set(u[d],{meshes:e,primitives:d});if(u.length===1)return i.extensions&&ze(s,u[0],i),u[0];const f=new ht;i.extensions&&ze(s,f,i),t.associations.set(f,{meshes:e});for(let d=0,p=u.length;d<p;d++)f.add(u[d]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Ht(Pi.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new Ut(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),he(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,i=t.joints.length;s<i;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const i=s.pop(),o=s,c=[],a=[];for(let l=0,h=o.length;l<h;l++){const u=o[l];if(u){c.push(u);const f=new Ge;i!==null&&f.fromArray(i.array,l*16),a.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Ni(c,a)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],i=s.name?s.name:"animation_"+e,o=[],c=[],a=[],l=[],h=[];for(let u=0,f=s.channels.length;u<f;u++){const d=s.channels[u],p=s.samplers[d.sampler],m=d.target,g=m.node,v=s.parameters!==void 0?s.parameters[p.input]:p.input,T=s.parameters!==void 0?s.parameters[p.output]:p.output;m.node!==void 0&&(o.push(this.getDependency("node",g)),c.push(this.getDependency("accessor",v)),a.push(this.getDependency("accessor",T)),l.push(p),h.push(m))}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(a),Promise.all(l),Promise.all(h)]).then(function(u){const f=u[0],d=u[1],p=u[2],m=u[3],g=u[4],v=[];for(let x=0,y=f.length;x<y;x++){const A=f[x],w=d[x],E=p[x],_=m[x],R=g[x];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const S=n._createAnimationTracks(A,w,E,_,R);if(S)for(let P=0;P<S.length;P++)v.push(S[P])}const T=new Oi(i,void 0,v);return he(T,s),T})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(i){const o=n._getNodeRef(n.meshCache,s.mesh,i);return s.weights!==void 0&&o.traverse(function(c){if(c.isMesh)for(let a=0,l=s.weights.length;a<l;a++)c.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],i=n._loadNodeShallow(e),o=[],c=s.children||[];for(let l=0,h=c.length;l<h;l++)o.push(n.getDependency("node",c[l]));const a=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([i,Promise.all(o),a]).then(function(l){const h=l[0],u=l[1],f=l[2];f!==null&&h.traverse(function(d){d.isSkinnedMesh&&d.bind(f,Hl)});for(let d=0,p=u.length;d<p;d++)h.add(u[d]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],o=i.name?s.createUniqueName(i.name):"",c=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&c.push(a),i.camera!==void 0&&c.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){c.push(l)}),this.nodeCache[e]=Promise.all(c).then(function(l){let h;if(i.isBone===!0?h=new Di:l.length>1?h=new ht:l.length===1?h=l[0]:h=new _n,h!==l[0])for(let u=0,f=l.length;u<f;u++)h.add(l[u]);if(i.name&&(h.userData.name=i.name,h.name=o),he(h,i),i.extensions&&ze(n,h,i),i.matrix!==void 0){const u=new Ge;u.fromArray(i.matrix),h.applyMatrix4(u)}else i.translation!==void 0&&h.position.fromArray(i.translation),i.rotation!==void 0&&h.quaternion.fromArray(i.rotation),i.scale!==void 0&&h.scale.fromArray(i.scale);if(!s.associations.has(h))s.associations.set(h,{});else if(i.mesh!==void 0&&s.meshCache.refs[i.mesh]>1){const u=s.associations.get(h);s.associations.set(h,{...u})}return s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,i=new ht;n.name&&(i.name=s.createUniqueName(n.name)),he(i,n),n.extensions&&ze(t,i,n);const o=n.nodes||[],c=[];for(let a=0,l=o.length;a<l;a++)c.push(s.getDependency("node",o[a]));return Promise.all(c).then(function(a){for(let h=0,u=a.length;h<u;h++)i.add(a[h]);const l=h=>{const u=new Map;for(const[f,d]of s.associations)(f instanceof Be||f instanceof Je)&&u.set(f,d);return h.traverse(f=>{const d=s.associations.get(f);d!=null&&u.set(f,d)}),u};return s.associations=l(i),i})}_createAnimationTracks(e,t,n,s,i){const o=[],c=e.name?e.name:e.uuid,a=[];Ie[i.path]===Ie.weights?e.traverse(function(f){f.morphTargetInfluences&&a.push(f.name?f.name:f.uuid)}):a.push(c);let l;switch(Ie[i.path]){case Ie.weights:l=sn;break;case Ie.rotation:l=rn;break;case Ie.translation:case Ie.scale:l=nn;break;default:n.itemSize===1?l=sn:l=nn;break}const h=s.interpolation!==void 0?Ol[s.interpolation]:Ln,u=this._getArrayFromAccessor(n);for(let f=0,d=a.length;f<d;f++){const p=new l(a[f]+"."+Ie[i.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=ms(t.constructor),s=new Float32Array(t.length);for(let i=0,o=t.length;i<o;i++)s[i]=t[i]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof rn?Nl:_r;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function jl(r,e,t){const n=e.attributes,s=new Gi;if(n.POSITION!==void 0){const c=t.json.accessors[n.POSITION],a=c.min,l=c.max;if(a!==void 0&&l!==void 0){if(s.set(new ie(a[0],a[1],a[2]),new ie(l[0],l[1],l[2])),c.normalized){const h=ms(mt[c.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const c=new ie,a=new ie;for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],d=f.min,p=f.max;if(d!==void 0&&p!==void 0){if(a.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),a.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),a.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),f.normalized){const m=ms(mt[f.componentType]);a.multiplyScalar(m)}c.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(c)}r.boundingBox=s;const o=new Hi;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,r.boundingSphere=o}function ai(r,e,t){const n=e.attributes,s=[];function i(o,c){return t.getDependency("accessor",o).then(function(a){r.setAttribute(c,a)})}for(const o in n){const c=ps[o]||o.toLowerCase();c in r.attributes||s.push(i(n[o],c))}if(e.indices!==void 0&&!r.index){const o=t.getDependency("accessor",e.indices).then(function(c){r.setIndex(c)});s.push(o)}return Yn.workingColorSpace!==ce&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Yn.workingColorSpace}" not supported.`),he(r,e),jl(r,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Fl(r,e.targets,t):r})}const Vl={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Vt{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const zl=new Ut(-1,1,1,-1,0,1);class Kl extends Cn{constructor(){super(),this.setAttribute("position",new Is([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Is([0,2,0,0,2,0],2))}}const Xl=new Kl;class br{constructor(e){this._mesh=new Gt(Xl,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,zl)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Wl extends Vt{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Tt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Xi.clone(e.uniforms),this.material=new Tt({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new br(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class ci extends Vt{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const s=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let o,c;this.inverse?(o=0,c=1):(o=1,c=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),i.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),i.buffers.stencil.setClear(c),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(s.EQUAL,1,4294967295),i.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),i.buffers.stencil.setLocked(!0)}}class ql extends Vt{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class $l{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new z);this._width=n.width,this._height=n.height,t=new jt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Br}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Wl(Vl),this.copyPass.material.blending=xs,this.clock=new Gr}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let s=0,i=this.passes.length;s<i;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const c=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(c.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(c.EQUAL,1,4294967295)}this.swapBuffers()}ci!==void 0&&(o instanceof ci?n=!0:o instanceof ql&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new z);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Yl extends Vt{constructor(e,t,n=null,s=null,i=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new K}render(e,t,n){const s=e.autoClear;e.autoClear=!1;let i,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(i),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=s}}const Qt={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#elif defined( CUSTOM_TONE_MAPPING )

				gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class Ql extends Vt{constructor(){super(),this.uniforms=Xi.clone(Qt.uniforms),this.material=new Hr({name:Qt.name,uniforms:this.uniforms,vertexShader:Qt.vertexShader,fragmentShader:Qt.fragmentShader}),this._fsQuad=new br(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},Yn.getTransfer(this._outputColorSpace)===Ur&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===jr?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===Vr?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===zr?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===ys?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===Kr?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===Xr?this.material.defines.NEUTRAL_TONE_MAPPING="":this._toneMapping===Wr&&(this.material.defines.CUSTOM_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}let j=null,Se=null,J=null,Ke=null,Mt=null,Ct=null,tn=null,Xe=null,En=!1;function Zl(){if(En)return;if(En=!0,Ke=new It,J=new Ht(100,window.innerWidth/window.innerHeight,.1,1e3),j=new zi({antialias:!0,alpha:!0}),j.setSize(window.innerWidth,window.innerHeight),j.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),j.toneMapping=ys,j.toneMappingExposure=1,j.shadowMap.enabled=!0,j.shadowMap.type=qr,Xe=document.querySelector("#background"),!Xe){Xe=document.createElement("div"),Xe.id="background";const u=document.body.firstChild;document.body.insertBefore(Xe,u)}Xe.appendChild(j.domElement);const r=new Ki(16777215,.5);Ke.add(r);const e=new Rn(16777215,1);e.position.set(5,5,5),Ke.add(e),new cl().load("/home/scene.glb",u=>{Ke.add(u.scene)},void 0,u=>console.error("GLTF load error:",u)),Mt=()=>{!J||!j||!Se||(J.aspect=window.innerWidth/window.innerHeight,J.updateProjectionMatrix(),j.setSize(window.innerWidth,window.innerHeight),Se.setSize(window.innerWidth,window.innerHeight))},window.addEventListener("resize",Mt),Se=new $l(j);const s=new Yl(Ke,J);Se.addPass(s);const i=new Ql;Se.addPass(i);let o={x:0,y:0},c={angle:Math.PI/2,y:0},a={angle:Math.PI/2,y:0};const l=Math.sqrt(50)/2.5;Ct=u=>{o.x=u.clientX/window.innerWidth*2-1,o.y=-(u.clientY/window.innerHeight)*2+1,c.angle=Math.PI/2-o.x*.1,c.y=o.y*.4},document.addEventListener("mousemove",Ct);const h=()=>{a.angle+=(c.angle-a.angle)*.025,a.y+=(c.y-a.y)*.025;const u=window.scrollY,d=Math.max(.5,l-u*.001);J.position.x=Math.cos(a.angle)*d,J.position.z=Math.sin(a.angle)*d,J.position.y+=a.y+1-J.position.y,J.lookAt(0,0,0),Se.render(),tn=requestAnimationFrame(h)};return h(),{scene:Ke,camera:J,renderer:j}}function $n(){En&&(En=!1,tn&&(cancelAnimationFrame(tn),tn=null),Mt&&(window.removeEventListener("resize",Mt),Mt=null),Ct&&(document.removeEventListener("mousemove",Ct),Ct=null),Se&&(Se.dispose(),Se=null),j&&(j.dispose(),j.domElement&&j.domElement.parentNode&&j.domElement.parentNode.removeChild(j.domElement),j=null),Ke=null,J=null,Xe=null)}function li(){const r=document.getElementById("time");if(r){const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");r.textContent=`${t}:${n}:${s} IST`}}function Jl(){li(),window.timeInterval&&clearInterval(window.timeInterval),window.timeInterval=setInterval(li,1e3)}function Ms(r){Jl(),Yr(),tr(),So(),Ji();const e=r||document.querySelector('[data-barba="container"]')?.dataset.barbaNamespace;e==="work"?(la(),$n(),ds()):e==="archive"?(dn(),$n(),al()):(dn(),ds(),e==="home"||e==="contact"?Zl():$n())}As.init({transitions:[{name:"home-contact-fade",from:{namespace:["home","contact"]},to:{namespace:["home","contact"]},async leave(r){Ps();const e=r?.current?.container?.querySelectorAll("a,p,h2,h3,h4");e?.length&&await F.to(e,{opacity:0,duration:.4,ease:"power2.out"})},async enter(r){await Ro(r?.next?.container)},async after(r){Ms(r?.next?.namespace||r?.current?.namespace)}},{name:"default",async leave(r){r?.current?.namespace==="home"&&dn(),r?.current?.namespace==="archive"&&ds(),Ps(),await $r()},async enter(){await Ns()},async once(){await Ns()}}]});As.hooks.once(r=>{Ms(r?.next?.namespace||r?.current?.namespace)});As.hooks.after(r=>{Ms(r?.next?.namespace||r?.current?.namespace)});
